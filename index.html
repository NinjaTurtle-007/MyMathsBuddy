<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathBuddy - Free CBSE Math Practice Worksheets | by @ninjaturtle_007</title>
    <meta name="description" content="Free CBSE Math practice worksheets for classes 1-8. All topics, 3 difficulty levels. Created by @ninjaturtle_007">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 50%, #fbbf24 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }
        
        /* Animations */
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-30px) rotate(15deg);
            }
        }
        
        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }
        
        @keyframes bounce-in {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        @keyframes confetti {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .float-symbol {
            position: absolute;
            font-size: 36px;
            opacity: 0.15;
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }
        
        .bg-circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            filter: blur(60px);
            animation: pulse 3s ease-in-out infinite;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.2);
        }
        
        .header-card {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 50%, #ec4899 100%);
            border: 4px solid white;
            animation: bounce-in 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .header-card:hover {
            transform: scale(1.02);
            transition: transform 0.3s;
        }
        
        .title {
            font-size: 36px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .subtitle {
            color: #fef08a;
            font-weight: 500;
            margin-top: 8px;
        }
        
        .icon-bounce {
            background: #fbbf24;
            padding: 12px;
            border-radius: 50%;
            animation: wiggle 2s ease-in-out infinite;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .score-badge {
            background: white;
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .score-badge:hover {
            transform: scale(1.1);
            transition: transform 0.3s;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #7c3aed;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 3px solid #d8b4fe;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            background: linear-gradient(135deg, #faf5ff 0%, #fce7f3 100%);
            transition: all 0.3s;
        }
        
        .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 0 4px rgba(168, 85, 247, 0.2);
        }
        
        .form-textarea {
            resize: none;
            font-family: inherit;
        }
        
        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 16px;
            font-weight: bold;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.3s;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        
        .btn:hover:not(:disabled) {
            transform: scale(1.05);
        }
        
        .btn:active:not(:disabled) {
            transform: scale(0.95);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #3b82f6 100%);
            color: white;
            width: 100%;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #14b8a6 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f97316 0%, #ef4444 100%);
            color: white;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #3b82f6 0%, #7c3aed 100%);
            color: white;
        }
        
        .btn-disabled {
            background: #9ca3af;
            color: white;
        }
        
        .alert {
            padding: 16px;
            border-radius: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 16px;
            animation: bounce-in 0.6s;
        }
        
        .alert-error {
            background: #fee2e2;
            border: 3px solid #fca5a5;
            color: #991b1b;
        }
        
        .question-card {
            border-left: 4px solid #6366f1;
            padding: 16px;
            background: linear-gradient(135deg, #eef2ff 0%, #f3e8ff 100%);
            border-radius: 0 16px 16px 0;
            margin-bottom: 24px;
            transition: all 0.3s;
        }
        
        .question-card:hover {
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .question-number {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold;
            color: #1f2937;
            font-size: 18px;
        }
        
        .number-badge {
            background: #6366f1;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }
        
        .marks-badge {
            background: #fbbf24;
            color: #78350f;
            padding: 6px 12px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 12px;
            border: 2px solid #f59e0b;
        }
        
        .question-text {
            color: #374151;
            font-size: 18px;
            line-height: 1.6;
            margin-bottom: 16px;
        }
        
        .answer-box {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border: 3px solid #6ee7b7;
            border-radius: 16px;
            padding: 16px;
            margin-top: 12px;
            animation: bounce-in 0.6s;
        }
        
        .answer-label {
            font-weight: bold;
            color: #065f46;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 18px;
        }
        
        .answer-text {
            color: #374151;
            line-height: 1.6;
        }
        
        .info-badge {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 50px;
            font-weight: 500;
            font-size: 14px;
            margin-right: 12px;
            margin-bottom: 12px;
        }
        
        .badge-yellow {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #fcd34d;
        }
        
        .badge-green {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #6ee7b7;
        }
        
        .badge-blue {
            background: #dbeafe;
            color: #1e40af;
            border: 2px solid #93c5fd;
        }
        
        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 24px;
        }
        
        .info-list {
            list-style-position: inside;
            list-style-type: decimal;
        }
        
        .info-list li {
            padding: 8px 0;
            padding-left: 8px;
            color: #374151;
            font-weight: 500;
        }
        
        .tip-box {
            background: linear-gradient(135deg, #dbeafe 0%, #e9d5ff 100%);
            border: 3px solid #93c5fd;
            border-radius: 16px;
            padding: 20px;
            margin-top: 24px;
        }
        
        .tip-text {
            color: #1e3a8a;
            font-weight: 500;
            line-height: 1.6;
        }
        
        .worksheet-header {
            border-bottom: 4px solid #bfdbfe;
            padding-bottom: 16px;
            margin-bottom: 24px;
            background: linear-gradient(135deg, #eff6ff 0%, #f3e8ff 100%);
            padding: 16px;
            border-radius: 16px;
        }
        
        .worksheet-title {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 12px;
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            animation: confetti 3s linear forwards;
            z-index: 9999;
        }
        
        .spinner {
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .title {
                font-size: 24px;
            }
            
            .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- jsPDF for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // CBSE Topics
        const CBSE_TOPICS = {
            1: ['Numbers 1-100', 'Addition and Subtraction', 'Shapes and Patterns', 'Measurement (Length, Weight)', 'Time', 'Money'],
            2: ['Numbers up to 1000', 'Addition and Subtraction', 'Multiplication Tables (2-5)', 'Division Basics', 'Shapes and Symmetry', 'Measurement', 'Time and Calendar', 'Money'],
            3: ['Numbers up to 10000', 'Addition and Subtraction', 'Multiplication (up to 10)', 'Division', 'Fractions', 'Measurement', 'Time', 'Money', 'Data Handling', 'Geometry'],
            4: ['Large Numbers', 'Four Operations', 'Multiples and Factors', 'Fractions', 'Decimals', 'Measurement', 'Geometry (Lines, Angles)', 'Symmetry', 'Perimeter and Area'],
            5: ['Large Numbers and Roman Numerals', 'Four Operations', 'Multiples and Factors', 'Fractions and Decimals', 'Percentage', 'Ratio and Proportion', 'Geometry', 'Perimeter and Area', 'Volume', 'Data Handling'],
            6: ['Number System', 'Whole Numbers', 'Playing with Numbers', 'Integers', 'Fractions and Decimals', 'Ratio and Proportion', 'Basic Geometry', 'Perimeter and Area', 'Data Handling', 'Algebra Basics'],
            7: ['Integers', 'Fractions and Decimals', 'Rational Numbers', 'Simple Equations', 'Lines and Angles', 'Triangles', 'Perimeter and Area', 'Exponents and Powers', 'Symmetry', 'Data Handling'],
            8: ['Rational Numbers', 'Exponents and Powers', 'Squares and Square Roots', 'Cubes and Cube Roots', 'Linear Equations', 'Percentage and Profit/Loss', 'Compound Interest', 'Geometry', 'Mensuration', 'Data Handling', 'Probability']
        };

        const mathSymbols = ['âž•', 'âž–', 'âœ–ï¸', 'âž—', 'ðŸ”¢', 'ðŸ“', 'ðŸ“', 'ðŸŽ¯', 'â­', 'ðŸ’¯', 'ðŸ§®', 'ðŸŽ¨', 'ðŸš€', 'ðŸŒŸ', 'ðŸ’¡', 'ðŸŽª', 'ðŸŽ­', 'ðŸŽ¬'];

        // Problem generator
        const random = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

        const generateProblem = (classNum, topic, difficulty, questionNum) => {
            const easyRange = classNum <= 3 ? 20 : 50;
            const mediumRange = classNum <= 3 ? 50 : 100;
            const hardRange = classNum <= 3 ? 100 : 500;
            const range = difficulty === 'easy' ? easyRange : difficulty === 'medium' ? mediumRange : hardRange;
            
            // TIME (Classes 1-4)
            if (topic.includes('Time') || topic.includes('Calendar')) {
                if (difficulty === 'easy') {
                    const easyTimeProblems = [
                        () => {
                            const hour = random(1, 12);
                            return {
                                question: `What time is it when the hour hand points to ${hour} and minute hand points to 12?`,
                                answer: `The time is ${hour}:00 (${hour} o'clock)`
                            };
                        },
                        () => {
                            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                            const dayIndex = random(0, 6);
                            const nextIndex = (dayIndex + 1) % 7;
                            return {
                                question: `If today is ${days[dayIndex]}, what day will it be tomorrow?`,
                                answer: `Tomorrow will be ${days[nextIndex]}`
                            };
                        },
                        () => {
                            const hour = random(1, 5);
                            return {
                                question: `How many hours are there from ${hour}:00 to ${hour + 1}:00?`,
                                answer: `There is 1 hour from ${hour}:00 to ${hour + 1}:00`
                            };
                        },
                        () => {
                            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            const monthIndex = random(0, 11);
                            const nextIndex = (monthIndex + 1) % 12;
                            return {
                                question: `Which month comes after ${months[monthIndex]}?`,
                                answer: `${months[nextIndex]} comes after ${months[monthIndex]}`
                            };
                        },
                        () => {
                            const hour = random(1, 12);
                            return {
                                question: `Where does the hour hand point when it is ${hour}:00?`,
                                answer: `The hour hand points at number ${hour}`
                            };
                        },
                        () => {
                            return {
                                question: `How many minutes are there in 1 hour?`,
                                answer: `There are 60 minutes in 1 hour`
                            };
                        },
                        () => {
                            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'];
                            const dayIndex = random(0, 5);
                            const prevIndex = (dayIndex - 1 + 7) % 7;
                            return {
                                question: `If today is ${days[dayIndex]}, what day was yesterday?`,
                                answer: `Yesterday was ${days[prevIndex]}`
                            };
                        },
                        () => {
                            return {
                                question: `How many days are there in one week?`,
                                answer: `There are 7 days in one week`
                            };
                        },
                        () => {
                            const hour = random(6, 11);
                            return {
                                question: `Is ${hour}:00 in the morning or evening?`,
                                answer: `${hour}:00 is in the ${hour < 12 ? 'morning' : 'evening'}`
                            };
                        },
                        () => {
                            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            return {
                                question: `How many months are there in one year?`,
                                answer: `There are 12 months in one year: ${months.join(', ')}`
                            };
                        }
                    ];
                    return easyTimeProblems[questionNum % easyTimeProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumTimeProblems = [
                        () => {
                            const hour = random(1, 12);
                            return {
                                question: `What time is shown when the hour hand is between ${hour} and ${hour + 1}, and minute hand points to 6 (half past)?`,
                                answer: `The time is ${hour}:30 (half past ${hour})`
                            };
                        },
                        () => {
                            const hour1 = random(1, 8);
                            const hour2 = hour1 + random(2, 4);
                            return {
                                question: `Ravi started studying at ${hour1}:00 and finished at ${hour2}:00. How many hours did he study?`,
                                answer: `Time studied = ${hour2}:00 - ${hour1}:00 = ${hour2 - hour1} hours`
                            };
                        },
                        () => {
                            const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
                            const monthIndex = random(0, 10);
                            return {
                                question: `Which month comes 2 months after ${months[monthIndex]}?`,
                                answer: `2 months after ${months[monthIndex]} is ${months[monthIndex + 2]}`
                            };
                        },
                        () => {
                            const hour = random(1, 11);
                            return {
                                question: `What time is quarter past ${hour} (15 minutes after ${hour}:00)?`,
                                answer: `Quarter past ${hour} is ${hour}:15`
                            };
                        },
                        () => {
                            const days = random(2, 5);
                            const hours = days * 24;
                            return {
                                question: `How many hours are there in ${days} days?`,
                                answer: `Hours in ${days} days = ${days} Ã— 24 = ${hours} hours`
                            };
                        },
                        () => {
                            const hour1 = random(2, 6);
                            const hour2 = hour1 + random(3, 6);
                            return {
                                question: `A movie started at ${hour1}:00 PM and ended at ${hour2}:00 PM. How long was the movie?`,
                                answer: `Duration = ${hour2}:00 - ${hour1}:00 = ${hour2 - hour1} hours`
                            };
                        },
                        () => {
                            const weeks = random(2, 4);
                            const days = weeks * 7;
                            return {
                                question: `How many days are there in ${weeks} weeks?`,
                                answer: `Days in ${weeks} weeks = ${weeks} Ã— 7 = ${days} days`
                            };
                        },
                        () => {
                            const hour = random(1, 11);
                            return {
                                question: `What time is quarter to ${hour + 1} (15 minutes before ${hour + 1}:00)?`,
                                answer: `Quarter to ${hour + 1} is ${hour}:45`
                            };
                        },
                        () => {
                            const months = ['January', 'March', 'May', 'July', 'August', 'October', 'December'];
                            const month = months[random(0, 6)];
                            return {
                                question: `How many days are there in ${month}?`,
                                answer: `${month} has 31 days`
                            };
                        },
                        () => {
                            const hour = random(1, 6);
                            const duration = random(30, 90);
                            return {
                                question: `If a class starts at ${hour}:00 and lasts for ${duration} minutes, when does it end?`,
                                answer: `End time = ${hour}:00 + ${duration} minutes = ${hour}:${duration >= 60 ? (duration - 60).toString().padStart(2, '0') : duration} ${duration >= 60 ? '(or ' + (hour + 1) + ':' + (duration - 60).toString().padStart(2, '0') + ')' : ''}`
                            };
                        }
                    ];
                    return mediumTimeProblems[questionNum % mediumTimeProblems.length]();
                } else { // hard
                    const hardTimeProblems = [
                        () => {
                            const hour = random(1, 11);
                            const minute1 = random(10, 30);
                            const minute2 = minute1 + random(20, 40);
                            const totalMinutes = minute2 - minute1;
                            return {
                                question: `A movie started at ${hour}:${minute1.toString().padStart(2, '0')} and ended at ${hour}:${minute2.toString().padStart(2, '0')}. How many minutes did the movie run?`,
                                answer: `Duration = ${minute2} - ${minute1} = ${totalMinutes} minutes`
                            };
                        },
                        () => {
                            const hour1 = random(8, 11);
                            const min1 = random(15, 45);
                            const hours = random(2, 4);
                            const mins = random(20, 50);
                            const totalMins = min1 + mins;
                            const finalHour = hour1 + hours + Math.floor(totalMins / 60);
                            const finalMin = totalMins % 60;
                            return {
                                question: `A train departed at ${hour1}:${min1.toString().padStart(2, '0')}. It took ${hours} hours and ${mins} minutes to reach. At what time did it arrive?`,
                                answer: `Arrival time = ${hour1}:${min1.toString().padStart(2, '0')} + ${hours}h ${mins}min = ${finalHour}:${finalMin.toString().padStart(2, '0')}`
                            };
                        },
                        () => {
                            const days = random(3, 7);
                            const hours = days * 24;
                            return {
                                question: `How many hours are there in ${days} days?`,
                                answer: `Hours in ${days} days = ${days} Ã— 24 = ${hours} hours`
                            };
                        },
                        () => {
                            const hour1 = random(10, 12);
                            const min1 = random(20, 50);
                            const hour2 = hour1 + random(2, 5);
                            const min2 = random(10, 50);
                            const hourDiff = hour2 - hour1;
                            const minDiff = min2 - min1;
                            return {
                                question: `Find the time difference between ${hour1}:${min1.toString().padStart(2, '0')} and ${hour2}:${min2.toString().padStart(2, '0')}`,
                                answer: `Time difference = ${hourDiff} hours and ${minDiff < 0 ? (60 + minDiff) + ' minutes (borrow 1 hour)' : minDiff + ' minutes'}`
                            };
                        },
                        () => {
                            const minutes = random(150, 300);
                            const hours = Math.floor(minutes / 60);
                            const remainingMins = minutes % 60;
                            return {
                                question: `Convert ${minutes} minutes to hours and minutes`,
                                answer: `${minutes} minutes = ${hours} hours and ${remainingMins} minutes`
                            };
                        },
                        () => {
                            const year = 2024;
                            return {
                                question: `${year} is a leap year. How many days does February have in a leap year?`,
                                answer: `February has 29 days in a leap year`
                            };
                        },
                        () => {
                            const hour = random(1, 6);
                            const min = random(10, 50);
                            const addHours = random(3, 6);
                            const addMins = random(20, 50);
                            const totalMins = min + addMins;
                            const finalHour = hour + addHours + Math.floor(totalMins / 60);
                            const finalMin = totalMins % 60;
                            return {
                                question: `If the current time is ${hour}:${min.toString().padStart(2, '0')} AM, what time will it be after ${addHours} hours and ${addMins} minutes?`,
                                answer: `Time after = ${hour}:${min.toString().padStart(2, '0')} + ${addHours}h ${addMins}min = ${finalHour}:${finalMin.toString().padStart(2, '0')} ${finalHour < 12 ? 'AM' : 'PM'}`
                            };
                        },
                        () => {
                            const weeks = random(3, 8);
                            const days = random(2, 6);
                            const totalDays = weeks * 7 + days;
                            return {
                                question: `How many days are in ${weeks} weeks and ${days} days?`,
                                answer: `Total days = (${weeks} Ã— 7) + ${days} = ${weeks * 7} + ${days} = ${totalDays} days`
                            };
                        },
                        () => {
                            const hour = random(6, 11);
                            return {
                                question: `A clock shows ${hour}:45. How many minutes until ${hour + 1}:00?`,
                                answer: `Minutes until next hour = 60 - 45 = 15 minutes`
                            };
                        },
                        () => {
                            const totalHours = random(50, 100);
                            const days = Math.floor(totalHours / 24);
                            const remainingHours = totalHours % 24;
                            return {
                                question: `Convert ${totalHours} hours into days and hours`,
                                answer: `${totalHours} hours = ${days} days and ${remainingHours} hours`
                            };
                        }
                    ];
                    return hardTimeProblems[questionNum % hardTimeProblems.length]();
                }
            }
            
            // MONEY (Classes 1-4)
            if (topic.includes('Money')) {
                if (difficulty === 'easy') {
                    const easyMoneyProblems = [
                        () => {
                            const rupees = random(1, 10);
                            return {
                                question: `How many â‚¹1 coins make â‚¹${rupees}?`,
                                answer: `${rupees} coins of â‚¹1 make â‚¹${rupees}`
                            };
                        },
                        () => {
                            const cost = random(5, 15);
                            return {
                                question: `A pencil costs â‚¹${cost}. How much will 2 pencils cost?`,
                                answer: `Cost of 2 pencils = â‚¹${cost} Ã— 2 = â‚¹${cost * 2}`
                            };
                        },
                        () => {
                            const cost1 = random(3, 10);
                            const cost2 = random(3, 10);
                            return {
                                question: `A pen costs â‚¹${cost1} and an eraser costs â‚¹${cost2}. What is the total cost?`,
                                answer: `Total cost = â‚¹${cost1} + â‚¹${cost2} = â‚¹${cost1 + cost2}`
                            };
                        },
                        () => {
                            const total = random(15, 30);
                            const spent = random(5, total - 5);
                            return {
                                question: `You have â‚¹${total}. You buy a toy for â‚¹${spent}. How much money is left?`,
                                answer: `Money left = â‚¹${total} - â‚¹${spent} = â‚¹${total - spent}`
                            };
                        },
                        () => {
                            const coins = random(3, 8);
                            return {
                                question: `You have ${coins} coins of â‚¹2 each. How much money in total?`,
                                answer: `Total = ${coins} Ã— â‚¹2 = â‚¹${coins * 2}`
                            };
                        },
                        () => {
                            return {
                                question: `Which is more: â‚¹10 or â‚¹5?`,
                                answer: `â‚¹10 is more than â‚¹5`
                            };
                        },
                        () => {
                            const fives = random(2, 5);
                            return {
                                question: `How much money is ${fives} coins of â‚¹5?`,
                                answer: `${fives} Ã— â‚¹5 = â‚¹${fives * 5}`
                            };
                        },
                        () => {
                            const item = ['chocolate', 'candy', 'notebook', 'eraser'][questionNum % 4];
                            const cost = random(5, 12);
                            const qty = 3;
                            return {
                                question: `Each ${item} costs â‚¹${cost}. How much for ${qty} ${item}s?`,
                                answer: `Total cost = ${qty} Ã— â‚¹${cost} = â‚¹${qty * cost}`
                            };
                        },
                        () => {
                            const note = random(10, 20);
                            const cost = random(5, note - 3);
                            return {
                                question: `You pay â‚¹${note} for an item that costs â‚¹${cost}. How much change do you get?`,
                                answer: `Change = â‚¹${note} - â‚¹${cost} = â‚¹${note - cost}`
                            };
                        },
                        () => {
                            const ones = random(3, 7);
                            const twos = random(2, 5);
                            return {
                                question: `Count: ${ones} coins of â‚¹1 and ${twos} coins of â‚¹2. Total?`,
                                answer: `Total = (${ones} Ã— â‚¹1) + (${twos} Ã— â‚¹2) = â‚¹${ones} + â‚¹${twos * 2} = â‚¹${ones + twos * 2}`
                            };
                        }
                    ];
                    return easyMoneyProblems[questionNum % easyMoneyProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumMoneyProblems = [
                        () => {
                            const total = random(50, 150);
                            const spent = random(20, total - 20);
                            return {
                                question: `Sita has â‚¹${total}. She buys a book for â‚¹${spent}. How much money does she have left?`,
                                answer: `Money left = â‚¹${total} - â‚¹${spent} = â‚¹${total - spent}`
                            };
                        },
                        () => {
                            const cost = random(20, 50);
                            const items = random(3, 5);
                            return {
                                question: `A notebook costs â‚¹${cost}. How much will ${items} notebooks cost?`,
                                answer: `Cost of ${items} notebooks = â‚¹${cost} Ã— ${items} = â‚¹${cost * items}`
                            };
                        },
                        () => {
                            const fives = random(4, 10);
                            const ones = random(3, 8);
                            return {
                                question: `Ram has ${fives} coins of â‚¹5 and ${ones} coins of â‚¹1. How much money does he have in total?`,
                                answer: `Total = (${fives} Ã— â‚¹5) + (${ones} Ã— â‚¹1) = â‚¹${fives * 5} + â‚¹${ones} = â‚¹${fives * 5 + ones}`
                            };
                        },
                        () => {
                            const paid = random(100, 200);
                            const cost = random(60, paid - 20);
                            return {
                                question: `You buy shoes for â‚¹${cost} and pay with a â‚¹${paid} note. What is your change?`,
                                answer: `Change = â‚¹${paid} - â‚¹${cost} = â‚¹${paid - cost}`
                            };
                        },
                        () => {
                            const tens = random(3, 8);
                            const fives = random(2, 6);
                            return {
                                question: `How much is ${tens} notes of â‚¹10 and ${fives} coins of â‚¹5?`,
                                answer: `Total = (${tens} Ã— â‚¹10) + (${fives} Ã— â‚¹5) = â‚¹${tens * 10} + â‚¹${fives * 5} = â‚¹${tens * 10 + fives * 5}`
                            };
                        },
                        () => {
                            const saved = random(30, 80);
                            const needed = random(saved + 10, saved + 50);
                            return {
                                question: `Maya has saved â‚¹${saved}. She wants to buy a toy for â‚¹${needed}. How much more money does she need?`,
                                answer: `More needed = â‚¹${needed} - â‚¹${saved} = â‚¹${needed - saved}`
                            };
                        },
                        () => {
                            const priceEach = random(15, 35);
                            const qty = random(4, 7);
                            return {
                                question: `Each ice cream costs â‚¹${priceEach}. What is the cost of ${qty} ice creams?`,
                                answer: `Total cost = ${qty} Ã— â‚¹${priceEach} = â‚¹${qty * priceEach}`
                            };
                        },
                        () => {
                            const item1 = random(25, 50);
                            const item2 = random(20, 45);
                            return {
                                question: `A bag costs â‚¹${item1} and a pencil box costs â‚¹${item2}. How much to buy both?`,
                                answer: `Total = â‚¹${item1} + â‚¹${item2} = â‚¹${item1 + item2}`
                            };
                        },
                        () => {
                            const twenties = random(2, 5);
                            const tens = random(3, 6);
                            return {
                                question: `Calculate the value of ${twenties} notes of â‚¹20 and ${tens} notes of â‚¹10`,
                                answer: `Total = (${twenties} Ã— â‚¹20) + (${tens} Ã— â‚¹10) = â‚¹${twenties * 20} + â‚¹${tens * 10} = â‚¹${twenties * 20 + tens * 10}`
                            };
                        },
                        () => {
                            const brother = random(40, 80);
                            const sister = random(50, 90);
                            return {
                                question: `Brother has â‚¹${brother} and sister has â‚¹${sister}. How much do they have together?`,
                                answer: `Together = â‚¹${brother} + â‚¹${sister} = â‚¹${brother + sister}`
                            };
                        }
                    ];
                    return mediumMoneyProblems[questionNum % mediumMoneyProblems.length]();
                } else { // hard
                    const hardMoneyProblems = [
                        () => {
                            const totalMoney = random(200, 600);
                            const item1Cost = random(50, 150);
                            const item2Cost = random(40, 120);
                            const spent = item1Cost + item2Cost;
                            const left = totalMoney - spent;
                            return {
                                question: `Maya has â‚¹${totalMoney}. She buys a book for â‚¹${item1Cost} and a pen for â‚¹${item2Cost}. How much money is left?`,
                                answer: `Total spent = â‚¹${item1Cost} + â‚¹${item2Cost} = â‚¹${spent}\nMoney left = â‚¹${totalMoney} - â‚¹${spent} = â‚¹${left}`
                            };
                        },
                        () => {
                            const costPer = random(35, 85);
                            const items = random(5, 9);
                            const paid = random(costPer * items + 50, costPer * items + 200);
                            const totalCost = costPer * items;
                            const change = paid - totalCost;
                            return {
                                question: `Each chocolate costs â‚¹${costPer}. You buy ${items} chocolates and pay â‚¹${paid}. How much change?`,
                                answer: `Total cost = â‚¹${costPer} Ã— ${items} = â‚¹${totalCost}\nChange = â‚¹${paid} - â‚¹${totalCost} = â‚¹${change}`
                            };
                        },
                        () => {
                            const tens = random(8, 18);
                            const fives = random(6, 15);
                            const ones = random(5, 12);
                            const total = tens * 10 + fives * 5 + ones;
                            return {
                                question: `Count total money: ${tens} notes of â‚¹10, ${fives} coins of â‚¹5, and ${ones} coins of â‚¹1`,
                                answer: `Total = (${tens} Ã— â‚¹10) + (${fives} Ã— â‚¹5) + (${ones} Ã— â‚¹1) = â‚¹${tens * 10} + â‚¹${fives * 5} + â‚¹${ones} = â‚¹${total}`
                            };
                        },
                        () => {
                            const friends = random(4, 6);
                            const total = random(200, 500);
                            const each = Math.floor(total / friends);
                            return {
                                question: `${friends} friends want to share â‚¹${total} equally. How much does each friend get?`,
                                answer: `Each friend gets = â‚¹${total} Ã· ${friends} = â‚¹${each}`
                            };
                        },
                        () => {
                            const item1 = random(125, 250);
                            const item2 = random(75, 180);
                            const item3 = random(50, 120);
                            const total = item1 + item2 + item3;
                            return {
                                question: `A shirt costs â‚¹${item1}, pants cost â‚¹${item2}, and socks cost â‚¹${item3}. Total cost?`,
                                answer: `Total = â‚¹${item1} + â‚¹${item2} + â‚¹${item3} = â‚¹${total}`
                            };
                        },
                        () => {
                            const fifties = random(3, 8);
                            const twenties = random(4, 10);
                            const tens = random(5, 12);
                            const total = fifties * 50 + twenties * 20 + tens * 10;
                            return {
                                question: `Calculate: ${fifties} notes of â‚¹50, ${twenties} notes of â‚¹20, ${tens} notes of â‚¹10`,
                                answer: `Total = (${fifties} Ã— â‚¹50) + (${twenties} Ã— â‚¹20) + (${tens} Ã— â‚¹10) = â‚¹${fifties * 50} + â‚¹${twenties * 20} + â‚¹${tens * 10} = â‚¹${total}`
                            };
                        },
                        () => {
                            const saved = random(150, 400);
                            const spent = random(60, saved - 50);
                            const earned = random(100, 250);
                            const final = saved - spent + earned;
                            return {
                                question: `Ravi had â‚¹${saved}, spent â‚¹${spent}, then earned â‚¹${earned}. How much does he have now?`,
                                answer: `Final amount = â‚¹${saved} - â‚¹${spent} + â‚¹${earned} = â‚¹${final}`
                            };
                        },
                        () => {
                            const costPer = random(45, 95);
                            const bought = random(6, 12);
                            const sold = random(bought + 10, bought + 30);
                            const profit = sold - costPer * bought;
                            return {
                                question: `Bought ${bought} pens at â‚¹${costPer} each. Sold all for â‚¹${sold}. Profit or loss?`,
                                answer: `Cost = ${bought} Ã— â‚¹${costPer} = â‚¹${bought * costPer}\nSold for = â‚¹${sold}\n${profit >= 0 ? 'Profit' : 'Loss'} = â‚¹${Math.abs(profit)}`
                            };
                        },
                        () => {
                            const price1 = random(80, 180);
                            const price2 = random(120, 250);
                            const discount = random(20, 60);
                            const total = price1 + price2 - discount;
                            return {
                                question: `Two items cost â‚¹${price1} and â‚¹${price2}. Got â‚¹${discount} discount. Final price?`,
                                answer: `Total before discount = â‚¹${price1} + â‚¹${price2} = â‚¹${price1 + price2}\nFinal price = â‚¹${price1 + price2} - â‚¹${discount} = â‚¹${total}`
                            };
                        },
                        () => {
                            const daily = random(30, 80);
                            const days = random(5, 10);
                            const total = daily * days;
                            return {
                                question: `If you save â‚¹${daily} every day, how much will you save in ${days} days?`,
                                answer: `Total savings = â‚¹${daily} Ã— ${days} = â‚¹${total}`
                            };
                        }
                    ];
                    return hardMoneyProblems[questionNum % hardMoneyProblems.length]();
                }
            }
            
            // SHAPES AND PATTERNS (Classes 1-4)
            if (topic.includes('Shape') || topic.includes('Pattern') || topic.includes('Symmetry')) {
                if (difficulty === 'easy') {
                    const problems = [
                        () => {
                            const sides = [3, 4][questionNum % 2];
                            const shapes = {3: 'triangle', 4: 'square'};
                            return {
                                question: `How many sides does a ${shapes[sides]} have?`,
                                answer: `A ${shapes[sides]} has ${sides} sides`
                            };
                        },
                        () => {
                            return {
                                question: `Which shape has no corners and is round?`,
                                answer: `A circle has no corners and is round`
                            };
                        },
                        () => {
                            const num = random(5, 10);
                            return {
                                question: `Complete the pattern: 1, 2, 3, __, 5. What number comes in the blank?`,
                                answer: `The pattern increases by 1, so the blank is 4`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else if (difficulty === 'medium') {
                    const problems = [
                        () => {
                            const shapes = {3: 'triangle', 4: 'rectangle', 5: 'pentagon', 6: 'hexagon'};
                            const sides = [3, 4, 5, 6][questionNum % 4];
                            return {
                                question: `A ${shapes[sides]} has how many corners (vertices)?`,
                                answer: `A ${shapes[sides]} has ${sides} corners`
                            };
                        },
                        () => {
                            const start = random(2, 5);
                            const pattern = `${start}, ${start + 2}, ${start + 4}, __, ${start + 8}`;
                            return {
                                question: `Complete the pattern: ${pattern}. What number fills the blank?`,
                                answer: `The pattern increases by 2 each time, so the blank is ${start + 6}`
                            };
                        },
                        () => {
                            return {
                                question: `Which shape has 4 sides where all sides are equal?`,
                                answer: `A square has 4 equal sides`
                            };
                        },
                        () => {
                            const triangles = random(3, 6);
                            const totalSides = triangles * 3;
                            return {
                                question: `If there are ${triangles} triangles, how many sides are there in total?`,
                                answer: `Total sides = ${triangles} Ã— 3 = ${totalSides} sides`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else { // hard
                    const problems = [
                        () => {
                            const squares = random(3, 8);
                            const triangles = random(2, 6);
                            const totalSides = squares * 4 + triangles * 3;
                            return {
                                question: `There are ${squares} squares and ${triangles} triangles. How many sides are there in total?`,
                                answer: `Sides in squares = ${squares} Ã— 4 = ${squares * 4}\nSides in triangles = ${triangles} Ã— 3 = ${triangles * 3}\nTotal sides = ${squares * 4} + ${triangles * 3} = ${totalSides}`
                            };
                        },
                        () => {
                            const start = random(3, 7);
                            const skip = random(3, 5);
                            return {
                                question: `Complete the pattern: ${start}, ${start + skip}, ${start + 2*skip}, __, ${start + 4*skip}. What is the blank and what is the rule?`,
                                answer: `The pattern increases by ${skip} each time\nThe blank is ${start + 3*skip}`
                            };
                        },
                        () => {
                            const perimeter = random(16, 40);
                            const side = perimeter / 4;
                            return {
                                question: `A square has a perimeter of ${perimeter} cm. What is the length of each side?`,
                                answer: `Each side = Perimeter Ã· 4 = ${perimeter} Ã· 4 = ${side} cm`
                            };
                        },
                        () => {
                            return {
                                question: `How many lines of symmetry does a square have?`,
                                answer: `A square has 4 lines of symmetry (2 diagonals and 2 through midpoints)`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                }
            }
            
            // MEASUREMENT - Length, Weight, Volume (Classes 1-4)
            if (topic.includes('Measurement') || topic.includes('Length') || topic.includes('Weight') || topic.includes('Volume')) {
                const problems = [
                    () => {
                        const length1 = random(5, 20);
                        const length2 = random(5, 20);
                        const longer = Math.max(length1, length2);
                        const shorter = Math.min(length1, length2);
                        return {
                            question: `A pencil is ${length1} cm long and a pen is ${length2} cm long. Which is longer and by how much?`,
                            answer: `The ${length1 > length2 ? 'pencil' : 'pen'} is longer by ${longer - shorter} cm`
                        };
                    },
                    () => {
                        const weight1 = random(10, 50);
                        const weight2 = random(10, 50);
                        return {
                            question: `A bag weighs ${weight1} kg and a box weighs ${weight2} kg. What is their total weight?`,
                            answer: `Total weight = ${weight1} kg + ${weight2} kg = ${weight1 + weight2} kg`
                        };
                    },
                    () => {
                        const cm = random(50, 200);
                        const m = Math.floor(cm / 100);
                        const remainingCm = cm % 100;
                        return {
                            question: `Convert ${cm} cm to meters and centimeters.`,
                            answer: `${cm} cm = ${m} meter${m !== 1 ? 's' : ''} and ${remainingCm} cm`
                        };
                    },
                    () => {
                        const items = random(2, 10);
                        const weightEach = random(2, 10);
                        return {
                            question: `If one apple weighs ${weightEach} grams, how much do ${items} apples weigh?`,
                            answer: `Total weight = ${items} Ã— ${weightEach}g = ${items * weightEach} grams`
                        };
                    },
                    () => {
                        const length = random(10, 50);
                        return {
                            question: `A rope is ${length} cm long. If we cut it into 2 equal pieces, how long is each piece?`,
                            answer: `Each piece = ${length} Ã· 2 = ${length / 2} cm`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // NUMBERS 1-100 or 1-1000 (Classes 1-3)
            if (topic.includes('Numbers') && !topic.includes('Roman') && !topic.includes('Large')) {
                const maxNum = topic.includes('100') ? 100 : topic.includes('1000') ? 1000 : topic.includes('10000') ? 10000 : 100;
                const problems = [
                    () => {
                        const num = random(1, maxNum);
                        return {
                            question: `Write the number that comes just after ${num}`,
                            answer: `The number after ${num} is ${num + 1}`
                        };
                    },
                    () => {
                        const num = random(2, maxNum);
                        return {
                            question: `Write the number that comes just before ${num}`,
                            answer: `The number before ${num} is ${num - 1}`
                        };
                    },
                    () => {
                        const num1 = random(1, maxNum);
                        const num2 = random(1, maxNum);
                        const larger = Math.max(num1, num2);
                        const smaller = Math.min(num1, num2);
                        return {
                            question: `Which is greater: ${num1} or ${num2}?`,
                            answer: `${larger} is greater than ${smaller}`
                        };
                    },
                    () => {
                        const num = random(10, maxNum);
                        const tens = Math.floor(num / 10);
                        const ones = num % 10;
                        return {
                            question: `In the number ${num}, what is in the tens place?`,
                            answer: `In ${num}, the tens place has ${tens}`
                        };
                    },
                    () => {
                        const start = random(1, 20);
                        const skip = 2;
                        return {
                            question: `Count by 2s: ${start}, ${start + skip}, ${start + 2*skip}, __, ${start + 4*skip}. What number fills the blank?`,
                            answer: `Counting by 2s: ${start + 3*skip}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // DATA HANDLING (Classes 3-8)
            if (topic.includes('Data')) {
                if (difficulty === 'easy') {
                    const easyDataProblems = [
                        () => {
                            const fruits = ['apples', 'bananas', 'oranges', 'mangoes'];
                            const counts = [random(5, 20), random(5, 20), random(5, 20), random(5, 20)];
                            const maxCount = Math.max(...counts);
                            const maxIndex = counts.indexOf(maxCount);
                            return {
                                question: `A fruit seller has ${counts[0]} ${fruits[0]}, ${counts[1]} ${fruits[1]}, ${counts[2]} ${fruits[2]}, and ${counts[3]} ${fruits[3]}. Which fruit does he have the most of?`,
                                answer: `He has the most ${fruits[maxIndex]} (${maxCount} pieces)`
                            };
                        },
                        () => {
                            const students = [random(10, 30), random(10, 30), random(10, 30)];
                            const total = students.reduce((a, b) => a + b, 0);
                            return {
                                question: `Class A has ${students[0]} students, Class B has ${students[1]} students, and Class C has ${students[2]} students. How many students in total?`,
                                answer: `Total students = ${students[0]} + ${students[1]} + ${students[2]} = ${total}`
                            };
                        },
                        () => {
                            const colors = ['red', 'blue', 'green'];
                            const counts = [random(8, 20), random(8, 20), random(8, 20)];
                            const minCount = Math.min(...counts);
                            const minIndex = counts.indexOf(minCount);
                            return {
                                question: `There are ${counts[0]} red balls, ${counts[1]} blue balls, and ${counts[2]} green balls. Which color has the least balls?`,
                                answer: `${colors[minIndex]} has the least balls (${minCount} balls)`
                            };
                        },
                        () => {
                            const day1 = random(15, 30);
                            const day2 = random(15, 30);
                            return {
                                question: `A shop sold ${day1} books on Monday and ${day2} books on Tuesday. How many books sold in 2 days?`,
                                answer: `Total books = ${day1} + ${day2} = ${day1 + day2}`
                            };
                        },
                        () => {
                            const heights = [random(120, 140), random(120, 140), random(120, 140)];
                            const tallest = Math.max(...heights);
                            return {
                                question: `Three children have heights ${heights[0]} cm, ${heights[1]} cm, and ${heights[2]} cm. Who is tallest?`,
                                answer: `The tallest child is ${tallest} cm tall`
                            };
                        },
                        () => {
                            const marks = [random(60, 90), random(60, 90), random(60, 90), random(60, 90)];
                            const average = Math.floor(marks.reduce((a, b) => a + b, 0) / marks.length);
                            return {
                                question: `A student scored ${marks[0]}, ${marks[1]}, ${marks[2]}, and ${marks[3]} in 4 tests. Find the average score.`,
                                answer: `Average = (${marks.join(' + ')}) Ã· 4 = ${marks.reduce((a, b) => a + b, 0)} Ã· 4 = ${average}`
                            };
                        },
                        () => {
                            const temp1 = random(25, 35);
                            const temp2 = random(25, 35);
                            const diff = Math.abs(temp1 - temp2);
                            return {
                                question: `Temperature on Day 1 was ${temp1}Â°C and Day 2 was ${temp2}Â°C. What is the difference?`,
                                answer: `Difference = ${Math.max(temp1, temp2)} - ${Math.min(temp1, temp2)} = ${diff}Â°C`
                            };
                        },
                        () => {
                            const boys = random(15, 30);
                            const girls = random(15, 30);
                            const total = boys + girls;
                            return {
                                question: `A class has ${boys} boys and ${girls} girls. How many students in total?`,
                                answer: `Total = ${boys} + ${girls} = ${total} students`
                            };
                        },
                        () => {
                            const numbers = [random(10, 50), random(10, 50), random(10, 50), random(10, 50), random(10, 50)];
                            const sum = numbers.reduce((a, b) => a + b, 0);
                            return {
                                question: `Find the sum of these numbers: ${numbers.join(', ')}`,
                                answer: `Sum = ${numbers.join(' + ')} = ${sum}`
                            };
                        },
                        () => {
                            const prices = [random(20, 50), random(20, 50), random(20, 50)];
                            const highest = Math.max(...prices);
                            const lowest = Math.min(...prices);
                            return {
                                question: `Three items cost â‚¹${prices[0]}, â‚¹${prices[1]}, and â‚¹${prices[2]}. Find the range (highest - lowest).`,
                                answer: `Range = ${highest} - ${lowest} = ${highest - lowest}`
                            };
                        }
                    ];
                    return easyDataProblems[questionNum % easyDataProblems.length]();
                } else {
                    // Medium and hard use similar concepts with bigger numbers
                    return easyDataProblems[questionNum % easyDataProblems.length]();
                }
            }
            
            // GEOMETRY - Lines and Angles (Classes 4-8)
            if (topic.includes('Geometry') || topic.includes('Lines') || topic.includes('Angles') || topic.includes('Triangles')) {
                if (difficulty === 'easy') {
                    const easyGeometryProblems = [
                        () => {
                            return {
                                question: `How many degrees are in a right angle?`,
                                answer: `A right angle = 90 degrees`
                            };
                        },
                        () => {
                            return {
                                question: `How many sides does a triangle have?`,
                                answer: `A triangle has 3 sides`
                            };
                        },
                        () => {
                            return {
                                question: `What is the sum of angles in a triangle?`,
                                answer: `The sum of angles in a triangle = 180 degrees`
                            };
                        },
                        () => {
                            const angle = 45;
                            return {
                                question: `Is a ${angle}Â° angle acute, right, or obtuse?`,
                                answer: `${angle}Â° is an acute angle (less than 90Â°)`
                            };
                        },
                        () => {
                            return {
                                question: `How many angles does a triangle have?`,
                                answer: `A triangle has 3 angles`
                            };
                        },
                        () => {
                            return {
                                question: `What is a straight angle in degrees?`,
                                answer: `A straight angle = 180 degrees`
                            };
                        },
                        () => {
                            return {
                                question: `How many sides does a rectangle have?`,
                                answer: `A rectangle has 4 sides`
                            };
                        },
                        () => {
                            const angle = 120;
                            return {
                                question: `Is a ${angle}Â° angle acute, right, or obtuse?`,
                                answer: `${angle}Â° is an obtuse angle (greater than 90Â°)`
                            };
                        },
                        () => {
                            return {
                                question: `What is the name of a 90Â° angle?`,
                                answer: `A 90Â° angle is called a right angle`
                            };
                        },
                        () => {
                            return {
                                question: `How many vertices does a triangle have?`,
                                answer: `A triangle has 3 vertices (corners)`
                            };
                        }
                    ];
                    return easyGeometryProblems[questionNum % easyGeometryProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumGeometryProblems = [
                        () => {
                            const angle1 = random(30, 70);
                            const angle2 = 90 - angle1;
                            return {
                                question: `Two angles are complementary. If one angle is ${angle1}Â°, what is the other angle?`,
                                answer: `Complementary angles add up to 90Â°\nOther angle = 90Â° - ${angle1}Â° = ${angle2}Â°`
                            };
                        },
                        () => {
                            const angle1 = random(60, 120);
                            const angle2 = 180 - angle1;
                            return {
                                question: `Two angles are supplementary. If one angle is ${angle1}Â°, find the other angle.`,
                                answer: `Supplementary angles add up to 180Â°\nOther angle = 180Â° - ${angle1}Â° = ${angle2}Â°`
                            };
                        },
                        () => {
                            const angle1 = random(40, 80);
                            const angle2 = random(40, 80);
                            const angle3 = 180 - angle1 - angle2;
                            return {
                                question: `In a triangle, two angles are ${angle1}Â° and ${angle2}Â°. Find the third angle.`,
                                answer: `Sum of angles in triangle = 180Â°\nThird angle = 180Â° - ${angle1}Â° - ${angle2}Â° = ${angle3}Â°`
                            };
                        },
                        () => {
                            return {
                                question: `What is the sum of all angles in a quadrilateral?`,
                                answer: `Sum of angles in a quadrilateral = 360Â°`
                            };
                        },
                        () => {
                            const angle = random(110, 160);
                            return {
                                question: `Classify the angle: ${angle}Â°. Is it acute, right, obtuse, or reflex?`,
                                answer: `${angle}Â° is an obtuse angle (between 90Â° and 180Â°)`
                            };
                        },
                        () => {
                            return {
                                question: `In an equilateral triangle, all angles are equal. What is each angle?`,
                                answer: `Each angle in equilateral triangle = 180Â° Ã· 3 = 60Â°`
                            };
                        },
                        () => {
                            const angle = random(45, 85);
                            return {
                                question: `Two parallel lines are cut by a transversal. If one angle is ${angle}Â°, what is its corresponding angle?`,
                                answer: `Corresponding angles are equal\nCorresponding angle = ${angle}Â°`
                            };
                        },
                        () => {
                            return {
                                question: `How many diagonals does a rectangle have?`,
                                answer: `A rectangle has 2 diagonals`
                            };
                        },
                        () => {
                            const angle = random(50, 80);
                            const verticalAngle = angle;
                            return {
                                question: `Two lines intersect. If one angle is ${angle}Â°, what is the vertically opposite angle?`,
                                answer: `Vertically opposite angles are equal\nVertically opposite angle = ${angle}Â°`
                            };
                        },
                        () => {
                            return {
                                question: `What is the name of a triangle with all three sides equal?`,
                                answer: `A triangle with all three equal sides is called an equilateral triangle`
                            };
                        }
                    ];
                    return mediumGeometryProblems[questionNum % mediumGeometryProblems.length]();
                } else { // hard
                    const hardGeometryProblems = [
                        () => {
                            const angle1 = random(45, 75);
                            const angle2 = random(45, 75);
                            const angle3 = 180 - angle1 - angle2;
                            return {
                                question: `In triangle ABC, angle A = ${angle1}Â° and angle B = ${angle2}Â°. Find angle C and classify the triangle.`,
                                answer: `Angle C = 180Â° - ${angle1}Â° - ${angle2}Â° = ${angle3}Â°\nAll angles < 90Â°, so it is an acute triangle`
                            };
                        },
                        () => {
                            const exteriorAngle = random(100, 140);
                            const angle1 = random(40, 70);
                            const angle2 = exteriorAngle - angle1;
                            return {
                                question: `The exterior angle of a triangle is ${exteriorAngle}Â°. If one interior opposite angle is ${angle1}Â°, find the other interior opposite angle.`,
                                answer: `Exterior angle = Sum of two interior opposite angles\nOther angle = ${exteriorAngle}Â° - ${angle1}Â° = ${angle2}Â°`
                            };
                        },
                        () => {
                            const angle = random(50, 80);
                            const adjacent = 180 - angle;
                            return {
                                question: `Two angles form a linear pair. If one angle is ${angle}Â°, find the other angle.`,
                                answer: `Linear pair angles sum to 180Â°\nOther angle = 180Â° - ${angle}Â° = ${adjacent}Â°`
                            };
                        },
                        () => {
                            const sides = random(5, 8);
                            const sumAngles = (sides - 2) * 180;
                            return {
                                question: `Find the sum of interior angles of a ${sides}-sided polygon.`,
                                answer: `Sum of interior angles = (n - 2) Ã— 180Â°\n= (${sides} - 2) Ã— 180Â° = ${sumAngles}Â°`
                            };
                        },
                        () => {
                            const angle1 = random(50, 70);
                            const angle2 = angle1; // isosceles
                            const angle3 = 180 - angle1 - angle2;
                            return {
                                question: `In an isosceles triangle, two base angles are equal to ${angle1}Â° each. Find the third angle.`,
                                answer: `Third angle = 180Â° - ${angle1}Â° - ${angle2}Â° = ${angle3}Â°`
                            };
                        },
                        () => {
                            return {
                                question: `In a right-angled triangle, one angle is 90Â°. If another angle is 35Â°, find the third angle.`,
                                answer: `Third angle = 180Â° - 90Â° - 35Â° = 55Â°`
                            };
                        },
                        () => {
                            const angle = random(60, 85);
                            const alternate = angle;
                            return {
                                question: `Two parallel lines are cut by a transversal. If one alternate interior angle is ${angle}Â°, find the other.`,
                                answer: `Alternate interior angles are equal\nOther angle = ${angle}Â°`
                            };
                        },
                        () => {
                            const sides = random(6, 10);
                            const eachAngle = ((sides - 2) * 180) / sides;
                            return {
                                question: `Find each interior angle of a regular ${sides}-sided polygon.`,
                                answer: `Each interior angle = [(n - 2) Ã— 180Â°] Ã· n\n= [(${sides} - 2) Ã— 180Â°] Ã· ${sides} = ${eachAngle}Â°`
                            };
                        },
                        () => {
                            return {
                                question: `The angles of a quadrilateral are in ratio 2:3:4:5. Find all four angles.`,
                                answer: `Let angles be 2x, 3x, 4x, 5x\nSum = 360Â°\n2x + 3x + 4x + 5x = 360Â°\n14x = 360Â°\nx = 25.7Â°\nAngles: 51.4Â°, 77.1Â°, 102.9Â°, 128.6Â°`
                            };
                        },
                        () => {
                            const angle1 = random(35, 55);
                            const angle2 = random(60, 80);
                            const angle3 = random(40, 60);
                            const angle4 = 360 - angle1 - angle2 - angle3;
                            return {
                                question: `Three angles of a quadrilateral are ${angle1}Â°, ${angle2}Â°, and ${angle3}Â°. Find the fourth angle.`,
                                answer: `Fourth angle = 360Â° - ${angle1}Â° - ${angle2}Â° - ${angle3}Â° = ${angle4}Â°`
                            };
                        }
                    ];
                    return hardGeometryProblems[questionNum % hardGeometryProblems.length]();
                }
            }
            
            // MULTIPLES AND FACTORS (Classes 4-6)
            if (topic.includes('Multiples') || topic.includes('Factors')) {
                const problems = [
                    () => {
                        const num = random(2, 12);
                        const multiple = num * random(2, 5);
                        return {
                            question: `Is ${multiple} a multiple of ${num}?`,
                            answer: `Yes, ${multiple} = ${num} Ã— ${multiple/num}, so ${multiple} is a multiple of ${num}`
                        };
                    },
                    () => {
                        const num = random(6, 20);
                        const factors = [];
                        for(let i = 1; i <= num; i++) {
                            if(num % i === 0) factors.push(i);
                        }
                        return {
                            question: `List all factors of ${num}`,
                            answer: `Factors of ${num} are: ${factors.join(', ')}`
                        };
                    },
                    () => {
                        const num = random(2, 12);
                        return {
                            question: `Write the first 3 multiples of ${num}`,
                            answer: `First 3 multiples of ${num} are: ${num}, ${num*2}, ${num*3}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // RATIO AND PROPORTION (Classes 5-8)
            if (topic.includes('Ratio') || topic.includes('Proportion')) {
                if (difficulty === 'easy') {
                    const problems = [
                        () => {
                            const a = random(2, 10);
                            const b = random(2, 10);
                            const gcd = (x, y) => y === 0 ? x : gcd(y, x % y);
                            const g = gcd(a, b);
                            return {
                                question: `Simplify the ratio ${a}:${b}`,
                                answer: `${a}:${b} = ${a/g}:${b/g} (dividing by GCD ${g})`
                            };
                        },
                        () => {
                            const boys = random(5, 15);
                            const girls = random(5, 15);
                            const gcd = (x, y) => y === 0 ? x : gcd(y, x % y);
                            const g = gcd(boys, girls);
                            return {
                                question: `In a class, there are ${boys} boys and ${girls} girls. Find the ratio of boys to girls.`,
                                answer: `Ratio of boys to girls = ${boys}:${girls} = ${boys/g}:${girls/g}`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else if (difficulty === 'medium') {
                    const problems = [
                        () => {
                            const ratio1 = random(2, 8);
                            const ratio2 = random(2, 8);
                            const total = random(30, 100);
                            const part1 = Math.floor((total * ratio1) / (ratio1 + ratio2));
                            const part2 = total - part1;
                            return {
                                question: `Divide ${total} in the ratio ${ratio1}:${ratio2}`,
                                answer: `Total parts = ${ratio1} + ${ratio2} = ${ratio1 + ratio2}\nFirst part = (${ratio1}/${ratio1 + ratio2}) Ã— ${total} = ${part1}\nSecond part = (${ratio2}/${ratio1 + ratio2}) Ã— ${total} = ${part2}`
                            };
                        },
                        () => {
                            const a = random(2, 10);
                            const b = random(2, 10);
                            const c = random(2, 10);
                            return {
                                question: `If A:B = ${a}:${b} and B:C = ${b}:${c}, find A:B:C`,
                                answer: `A:B:C = ${a}:${b}:${c}`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else { // hard
                    const problems = [
                        () => {
                            const ratio1 = random(3, 12);
                            const ratio2 = random(3, 12);
                            const ratio3 = random(3, 12);
                            const total = random(100, 500);
                            const sum = ratio1 + ratio2 + ratio3;
                            const part1 = Math.floor((total * ratio1) / sum);
                            const part2 = Math.floor((total * ratio2) / sum);
                            const part3 = total - part1 - part2;
                            return {
                                question: `Divide ${total} among three people in the ratio ${ratio1}:${ratio2}:${ratio3}`,
                                answer: `Total parts = ${ratio1} + ${ratio2} + ${ratio3} = ${sum}\nFirst person = (${ratio1}/${sum}) Ã— ${total} = ${part1}\nSecond person = (${ratio2}/${sum}) Ã— ${total} = ${part2}\nThird person = ${part3}`
                            };
                        },
                        () => {
                            const speed1 = random(40, 80);
                            const speed2 = random(40, 80);
                            const gcd = (x, y) => y === 0 ? x : gcd(y, x % y);
                            const g = gcd(speed1, speed2);
                            return {
                                question: `Two cars travel at ${speed1} km/h and ${speed2} km/h. Find the ratio of their speeds in simplest form.`,
                                answer: `Ratio = ${speed1}:${speed2} = ${speed1/g}:${speed2/g}`
                            };
                        },
                        () => {
                            const ratio1 = random(3, 8);
                            const ratio2 = random(3, 8);
                            const increase = random(10, 50);
                            const newRatio1 = ratio1 + increase;
                            const gcd = (x, y) => y === 0 ? x : gcd(y, x % y);
                            const g = gcd(newRatio1, ratio2);
                            return {
                                question: `The ratio of two numbers is ${ratio1}:${ratio2}. If the first number is increased by ${increase}, what is the new ratio?`,
                                answer: `New ratio = ${newRatio1}:${ratio2} = ${newRatio1/g}:${ratio2/g}`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                }
            }
            
            // INTEGERS (Classes 6-8)
            if (topic.includes('Integer')) {
                const problems = [
                    () => {
                        const a = random(-50, 50);
                        const b = random(-50, 50);
                        return {
                            question: `Calculate: (${a}) + (${b})`,
                            answer: `(${a}) + (${b}) = ${a + b}`
                        };
                    },
                    () => {
                        const a = random(-50, 50);
                        const b = random(-50, 50);
                        return {
                            question: `Calculate: (${a}) - (${b})`,
                            answer: `(${a}) - (${b}) = ${a - b}`
                        };
                    },
                    () => {
                        const a = random(-12, 12);
                        const b = random(-12, 12);
                        return {
                            question: `Calculate: (${a}) Ã— (${b})`,
                            answer: `(${a}) Ã— (${b}) = ${a * b}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // ALGEBRA (Classes 6-8)
            if (topic.includes('Algebra') || topic.includes('Equation')) {
                const problems = [
                    () => {
                        const a = random(2, 15);
                        const b = random(1, 20);
                        const x = random(1, 10);
                        const result = a * x + b;
                        return {
                            question: `Solve for x: ${a}x + ${b} = ${result}`,
                            answer: `${a}x + ${b} = ${result}\n${a}x = ${result} - ${b}\n${a}x = ${result - b}\nx = ${(result - b) / a}`
                        };
                    },
                    () => {
                        const a = random(2, 10);
                        const b = random(1, 15);
                        return {
                            question: `Simplify: ${a}x + ${b}x`,
                            answer: `${a}x + ${b}x = ${a + b}x`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // EXPONENTS AND POWERS (Classes 7-8)
            if (topic.includes('Exponent') || topic.includes('Power')) {
                const problems = [
                    () => {
                        const base = random(2, 10);
                        const exp1 = random(2, 5);
                        const exp2 = random(2, 5);
                        return {
                            question: `Simplify: ${base}^${exp1} Ã— ${base}^${exp2}`,
                            answer: `${base}^${exp1} Ã— ${base}^${exp2} = ${base}^${exp1 + exp2} = ${Math.pow(base, exp1 + exp2)}`
                        };
                    },
                    () => {
                        const base = random(2, 10);
                        const exp = random(2, 4);
                        return {
                            question: `Calculate: ${base}^${exp}`,
                            answer: `${base}^${exp} = ${Math.pow(base, exp)}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // SQUARES AND SQUARE ROOTS (Class 8)
            if (topic.includes('Square')) {
                const problems = [
                    () => {
                        const n = random(1, 20);
                        return {
                            question: `Find the square of ${n}`,
                            answer: `${n}Â² = ${n * n}`
                        };
                    },
                    () => {
                        const n = random(1, 12);
                        const square = n * n;
                        return {
                            question: `Find the square root of ${square}`,
                            answer: `âˆš${square} = ${n}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // FOUR OPERATIONS (Classes 4-5)
            if (topic.includes('Four Operations') || topic.includes('Four operations')) {
                if (difficulty === 'easy') {
                    const easyFourOpsProblems = [
                        () => {
                            const a = random(10, 50);
                            const b = random(5, 30);
                            return {
                                question: `Add: ${a} + ${b}`,
                                answer: `${a} + ${b} = ${a + b}`
                            };
                        },
                        () => {
                            const a = random(20, 80);
                            const b = random(5, a - 5);
                            return {
                                question: `Subtract: ${a} - ${b}`,
                                answer: `${a} - ${b} = ${a - b}`
                            };
                        },
                        () => {
                            const a = random(3, 9);
                            const b = random(3, 9);
                            return {
                                question: `Multiply: ${a} Ã— ${b}`,
                                answer: `${a} Ã— ${b} = ${a * b}`
                            };
                        },
                        () => {
                            const divisor = random(2, 8);
                            const quotient = random(3, 12);
                            const dividend = divisor * quotient;
                            return {
                                question: `Divide: ${dividend} Ã· ${divisor}`,
                                answer: `${dividend} Ã· ${divisor} = ${quotient}`
                            };
                        },
                        () => {
                            const a = random(5, 20);
                            const b = random(3, 15);
                            const c = random(2, 10);
                            return {
                                question: `Calculate: ${a} + ${b} - ${c}`,
                                answer: `${a} + ${b} - ${c} = ${a + b} - ${c} = ${a + b - c}`
                            };
                        },
                        () => {
                            const a = random(4, 10);
                            const b = random(2, 8);
                            const c = random(2, 6);
                            return {
                                question: `Calculate: ${a} Ã— ${b} + ${c}`,
                                answer: `${a} Ã— ${b} + ${c} = ${a * b} + ${c} = ${a * b + c}`
                            };
                        },
                        () => {
                            const a = random(10, 30);
                            const b = random(10, 30);
                            const c = random(10, 30);
                            return {
                                question: `Add three numbers: ${a} + ${b} + ${c}`,
                                answer: `${a} + ${b} + ${c} = ${a + b + c}`
                            };
                        },
                        () => {
                            const a = random(6, 12);
                            const b = random(2, 5);
                            return {
                                question: `Calculate: ${a} Ã— ${b} - ${b}`,
                                answer: `${a} Ã— ${b} - ${b} = ${a * b} - ${b} = ${a * b - b}`
                            };
                        },
                        () => {
                            const divisor = random(3, 7);
                            const quotient = random(4, 10);
                            const dividend = divisor * quotient;
                            const add = random(5, 15);
                            return {
                                question: `Calculate: ${dividend} Ã· ${divisor} + ${add}`,
                                answer: `${dividend} Ã· ${divisor} + ${add} = ${quotient} + ${add} = ${quotient + add}`
                            };
                        },
                        () => {
                            const a = random(50, 100);
                            const b = random(20, 40);
                            const c = random(10, 25);
                            return {
                                question: `Calculate: ${a} - ${b} + ${c}`,
                                answer: `${a} - ${b} + ${c} = ${a - b} + ${c} = ${a - b + c}`
                            };
                        }
                    ];
                    return easyFourOpsProblems[questionNum % easyFourOpsProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumFourOpsProblems = [
                        () => {
                            const a = random(100, 500);
                            const b = random(50, 300);
                            const c = random(30, 200);
                            return {
                                question: `Calculate: ${a} + ${b} + ${c}`,
                                answer: `${a} + ${b} + ${c} = ${a + b + c}`
                            };
                        },
                        () => {
                            const a = random(200, 800);
                            const b = random(50, 300);
                            const c = random(30, 150);
                            return {
                                question: `Calculate: ${a} - ${b} - ${c}`,
                                answer: `${a} - ${b} - ${c} = ${a - b - c}`
                            };
                        },
                        () => {
                            const a = random(12, 25);
                            const b = random(12, 25);
                            return {
                                question: `Multiply: ${a} Ã— ${b}`,
                                answer: `${a} Ã— ${b} = ${a * b}`
                            };
                        },
                        () => {
                            const divisor = random(12, 25);
                            const quotient = random(10, 40);
                            const dividend = divisor * quotient;
                            return {
                                question: `Divide: ${dividend} Ã· ${divisor}`,
                                answer: `${dividend} Ã· ${divisor} = ${quotient}`
                            };
                        },
                        () => {
                            const a = random(15, 30);
                            const b = random(8, 20);
                            const c = random(5, 15);
                            const d = random(10, 25);
                            return {
                                question: `Calculate: ${a} Ã— ${b} - ${c} Ã— ${d}`,
                                answer: `${a} Ã— ${b} - ${c} Ã— ${d} = ${a * b} - ${c * d} = ${a * b - c * d}`
                            };
                        },
                        () => {
                            const a = random(100, 300);
                            const b = random(50, 150);
                            const c = random(5, 12);
                            return {
                                question: `Calculate: (${a} + ${b}) Ã· ${c}`,
                                answer: `(${a} + ${b}) Ã· ${c} = ${a + b} Ã· ${c} = ${Math.floor((a + b) / c)}`
                            };
                        },
                        () => {
                            const a = random(20, 50);
                            const b = random(10, 30);
                            const c = random(3, 8);
                            return {
                                question: `Calculate: ${a} + ${b} Ã— ${c}`,
                                answer: `${a} + ${b} Ã— ${c} = ${a} + ${b * c} = ${a + b * c} (multiply first)`
                            };
                        },
                        () => {
                            const a = random(100, 400);
                            const b = random(5, 15);
                            const c = random(20, 80);
                            return {
                                question: `Calculate: ${a} - ${b} Ã— ${c}`,
                                answer: `${a} - ${b} Ã— ${c} = ${a} - ${b * c} = ${a - b * c} (multiply first)`
                            };
                        },
                        () => {
                            const dividend = random(100, 300);
                            const divisor = random(5, 12);
                            const quotient = Math.floor(dividend / divisor);
                            const add = random(50, 150);
                            return {
                                question: `Calculate: ${dividend} Ã· ${divisor} + ${add}`,
                                answer: `${dividend} Ã· ${divisor} + ${add} = ${quotient} + ${add} = ${quotient + add}`
                            };
                        },
                        () => {
                            const a = random(8, 15);
                            const b = random(6, 12);
                            const c = random(4, 10);
                            return {
                                question: `Calculate: ${a} Ã— ${b} Ã— ${c}`,
                                answer: `${a} Ã— ${b} Ã— ${c} = ${a * b * c}`
                            };
                        }
                    ];
                    return mediumFourOpsProblems[questionNum % mediumFourOpsProblems.length]();
                } else { // hard
                    const hardFourOpsProblems = [
                        () => {
                            const a = random(500, 2000);
                            const b = random(300, 1500);
                            const c = random(200, 1000);
                            const d = random(100, 800);
                            return {
                                question: `Calculate: ${a} + ${b} - ${c} + ${d}`,
                                answer: `${a} + ${b} - ${c} + ${d} = ${a + b - c + d}`
                            };
                        },
                        () => {
                            const a = random(20, 50);
                            const b = random(15, 40);
                            const c = random(10, 30);
                            const d = random(5, 20);
                            return {
                                question: `Calculate: ${a} Ã— ${b} - ${c} Ã— ${d}`,
                                answer: `${a} Ã— ${b} - ${c} Ã— ${d} = ${a * b} - ${c * d} = ${a * b - c * d}`
                            };
                        },
                        () => {
                            const a = random(15, 35);
                            const b = random(12, 28);
                            const c = random(8, 20);
                            return {
                                question: `Calculate: (${a} + ${b}) Ã— ${c}`,
                                answer: `(${a} + ${b}) Ã— ${c} = ${a + b} Ã— ${c} = ${(a + b) * c}`
                            };
                        },
                        () => {
                            const dividend = random(500, 1500);
                            const divisor = random(15, 40);
                            const quotient = Math.floor(dividend / divisor);
                            const mult = random(10, 25);
                            return {
                                question: `Calculate: ${dividend} Ã· ${divisor} Ã— ${mult}`,
                                answer: `${dividend} Ã· ${divisor} Ã— ${mult} = ${quotient} Ã— ${mult} = ${quotient * mult}`
                            };
                        },
                        () => {
                            const a = random(100, 400);
                            const b = random(12, 30);
                            const c = random(8, 20);
                            const d = random(50, 150);
                            return {
                                question: `Calculate: ${a} + ${b} Ã— ${c} - ${d}`,
                                answer: `${a} + ${b} Ã— ${c} - ${d} = ${a} + ${b * c} - ${d} = ${a + b * c - d} (multiply first)`
                            };
                        },
                        () => {
                            const a = random(200, 600);
                            const b = random(100, 300);
                            const c = random(10, 25);
                            return {
                                question: `Calculate: (${a} - ${b}) Ã· ${c}`,
                                answer: `(${a} - ${b}) Ã· ${c} = ${a - b} Ã· ${c} = ${Math.floor((a - b) / c)}`
                            };
                        },
                        () => {
                            const a = random(25, 50);
                            const b = random(18, 35);
                            const c = random(5, 15);
                            const d = random(10, 25);
                            return {
                                question: `Calculate: ${a} Ã— ${b} Ã· ${c} + ${d}`,
                                answer: `${a} Ã— ${b} Ã· ${c} + ${d} = ${a * b} Ã· ${c} + ${d} = ${Math.floor(a * b / c)} + ${d} = ${Math.floor(a * b / c) + d}`
                            };
                        },
                        () => {
                            const a = random(1000, 3000);
                            const b = random(20, 50);
                            const c = random(15, 40);
                            return {
                                question: `Calculate: ${a} - ${b} Ã— ${c}`,
                                answer: `${a} - ${b} Ã— ${c} = ${a} - ${b * c} = ${a - b * c} (multiply first)`
                            };
                        },
                        () => {
                            const a = random(12, 25);
                            const b = random(15, 30);
                            const c = random(8, 18);
                            const d = random(5, 12);
                            return {
                                question: `Calculate: (${a} + ${b}) Ã— (${c} - ${d})`,
                                answer: `(${a} + ${b}) Ã— (${c} - ${d}) = ${a + b} Ã— ${c - d} = ${(a + b) * (c - d)}`
                            };
                        },
                        () => {
                            const a = random(800, 2000);
                            const b = random(15, 35);
                            const c = random(10, 25);
                            const d = random(100, 400);
                            return {
                                question: `Calculate: ${a} Ã· ${b} + ${c} Ã— ${d}`,
                                answer: `${a} Ã· ${b} + ${c} Ã— ${d} = ${Math.floor(a / b)} + ${c * d} = ${Math.floor(a / b) + c * d} (division and multiplication first)`
                            };
                        }
                    ];
                    return hardFourOpsProblems[questionNum % hardFourOpsProblems.length]();
                }
            }
            
            // ADDITION AND SUBTRACTION
            if (topic.includes('Addition') || topic.includes('Subtraction')) {
                const easyMax = classNum <= 2 ? 20 : classNum <= 4 ? 50 : 100;
                const mediumMax = classNum <= 2 ? 50 : classNum <= 4 ? 200 : 1000;
                const hardMax = classNum <= 2 ? 100 : classNum <= 4 ? 500 : 5000;
                
                const maxNum = difficulty === 'easy' ? easyMax : difficulty === 'medium' ? mediumMax : hardMax;
                
                const a = random(1, maxNum);
                const b = random(1, maxNum);
                
                if (questionNum % 2 === 0) {
                    // Addition
                    if (difficulty === 'easy') {
                        return {
                            question: `Calculate: ${a} + ${b}`,
                            answer: `${a} + ${b} = ${a + b}`
                        };
                    } else if (difficulty === 'medium') {
                        const c = random(1, maxNum);
                        return {
                            question: `Calculate: ${a} + ${b} + ${c}`,
                            answer: `${a} + ${b} + ${c} = ${a + b + c}`
                        };
                    } else {
                        const c = random(1, maxNum);
                        const d = random(1, maxNum);
                        return {
                            question: `Calculate: ${a} + ${b} + ${c} + ${d}`,
                            answer: `${a} + ${b} + ${c} + ${d} = ${a + b + c + d}`
                        };
                    }
                } else {
                    // Subtraction
                    const larger = Math.max(a, b);
                    const smaller = Math.min(a, b);
                    
                    if (difficulty === 'easy') {
                        return {
                            question: `Calculate: ${larger} - ${smaller}`,
                            answer: `${larger} - ${smaller} = ${larger - smaller}`
                        };
                    } else if (difficulty === 'medium') {
                        const c = random(1, larger - smaller);
                        return {
                            question: `Calculate: ${larger} - ${smaller} - ${c}`,
                            answer: `${larger} - ${smaller} - ${c} = ${larger - smaller - c}`
                        };
                    } else {
                        const total = larger + smaller;
                        return {
                            question: `What number should be added to ${smaller} to get ${total}?`,
                            answer: `Number to add = ${total} - ${smaller} = ${larger}`
                        };
                    }
                }
            }
            
            // MULTIPLICATION
            if (topic.includes('Multiplication')) {
                if (difficulty === 'easy') {
                    const a = random(2, 5);
                    const b = random(2, 5);
                    if (questionNum % 2 === 0) {
                        return {
                            question: `${a} Ã— ${b} = ?`,
                            answer: `${a} Ã— ${b} = ${a * b}`
                        };
                    } else {
                        return {
                            question: `A box has ${a} pencils. How many pencils are in ${b} boxes?`,
                            answer: `Total pencils = ${a} Ã— ${b} = ${a * b} pencils`
                        };
                    }
                } else if (difficulty === 'medium') {
                    const a = random(6, 12);
                    const b = random(6, 12);
                    if (questionNum % 2 === 0) {
                        return {
                            question: `${a} Ã— ${b} = ?`,
                            answer: `${a} Ã— ${b} = ${a * b}`
                        };
                    } else {
                        return {
                            question: `Ravi bought ${a} packets of biscuits. Each packet has ${b} biscuits. How many biscuits in total?`,
                            answer: `Total biscuits = ${a} Ã— ${b} = ${a * b} biscuits`
                        };
                    }
                } else { // hard
                    const a = random(12, 25);
                    const b = random(12, 25);
                    if (questionNum % 3 === 0) {
                        return {
                            question: `${a} Ã— ${b} = ?`,
                            answer: `${a} Ã— ${b} = ${a * b}`
                        };
                    } else if (questionNum % 3 === 1) {
                        const c = random(2, 5);
                        return {
                            question: `Calculate: ${a} Ã— ${b} Ã— ${c}`,
                            answer: `${a} Ã— ${b} Ã— ${c} = ${a * b * c}`
                        };
                    } else {
                        return {
                            question: `A factory produces ${a} toys per hour. How many toys will it produce in ${b} hours?`,
                            answer: `Total toys = ${a} Ã— ${b} = ${a * b} toys`
                        };
                    }
                }
            }
            
            // DIVISION
            if (topic.includes('Division')) {
                if (difficulty === 'easy') {
                    const divisor = random(2, 5);
                    const quotient = random(2, 10);
                    const dividend = divisor * quotient;
                    if (questionNum % 2 === 0) {
                        return {
                            question: `${dividend} Ã· ${divisor} = ?`,
                            answer: `${dividend} Ã· ${divisor} = ${quotient}`
                        };
                    } else {
                        return {
                            question: `${dividend} sweets are divided equally among ${divisor} children. How many sweets does each child get?`,
                            answer: `Each child gets = ${dividend} Ã· ${divisor} = ${quotient} sweets`
                        };
                    }
                } else if (difficulty === 'medium') {
                    const divisor = random(6, 12);
                    const quotient = random(5, 15);
                    const dividend = divisor * quotient;
                    if (questionNum % 2 === 0) {
                        return {
                            question: `${dividend} Ã· ${divisor} = ?`,
                            answer: `${dividend} Ã· ${divisor} = ${quotient}`
                        };
                    } else {
                        return {
                            question: `A gardener has ${dividend} plants. He plants them in ${divisor} rows equally. How many plants in each row?`,
                            answer: `Plants per row = ${dividend} Ã· ${divisor} = ${quotient} plants`
                        };
                    }
                } else { // hard
                    const divisor = random(12, 25);
                    const quotient = random(10, 40);
                    const dividend = divisor * quotient;
                    if (questionNum % 3 === 0) {
                        return {
                            question: `${dividend} Ã· ${divisor} = ?`,
                            answer: `${dividend} Ã· ${divisor} = ${quotient}`
                        };
                    } else if (questionNum % 3 === 1) {
                        const remainder = random(1, divisor - 1);
                        const dividendWithRem = dividend + remainder;
                        return {
                            question: `Divide ${dividendWithRem} by ${divisor}. What is the quotient and remainder?`,
                            answer: `${dividendWithRem} Ã· ${divisor} = ${quotient} remainder ${remainder}`
                        };
                    } else {
                        return {
                            question: `${dividend} books are to be packed in boxes. Each box holds ${divisor} books. How many boxes are needed?`,
                            answer: `Number of boxes = ${dividend} Ã· ${divisor} = ${quotient} boxes`
                        };
                    }
                }
            }
            
            // FRACTIONS (Classes 3-7) - COMPREHENSIVE
            if (topic.includes('Fraction')) {
                // Helper function to find GCD
                const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
                
                // Helper function to simplify fraction
                const simplify = (num, den) => {
                    const g = gcd(Math.abs(num), Math.abs(den));
                    return { num: num / g, den: den / g };
                };
                
                if (difficulty === 'easy') {
                    // EASY: Only LIKE fractions (same denominator)
                    const easyProblems = [
                        () => {
                            const num1 = random(1, 8);
                            const num2 = random(1, 8);
                            const den = random(2, 10);
                            const sum = num1 + num2;
                            const simplified = simplify(sum, den);
                            return {
                                question: `Add: ${num1}/${den} + ${num2}/${den}`,
                                answer: `${num1}/${den} + ${num2}/${den} = ${sum}/${den}${simplified.den !== den ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        },
                        () => {
                            const num1 = random(5, 12);
                            const num2 = random(1, num1 - 1);
                            const den = random(2, 10);
                            const diff = num1 - num2;
                            const simplified = simplify(diff, den);
                            return {
                                question: `Subtract: ${num1}/${den} - ${num2}/${den}`,
                                answer: `${num1}/${den} - ${num2}/${den} = ${diff}/${den}${simplified.den !== den ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        },
                        () => {
                            const num1 = random(1, 5);
                            const num2 = random(1, 5);
                            const num3 = random(1, 5);
                            const den = random(3, 8);
                            const sum = num1 + num2 + num3;
                            return {
                                question: `Add: ${num1}/${den} + ${num2}/${den} + ${num3}/${den}`,
                                answer: `${num1}/${den} + ${num2}/${den} + ${num3}/${den} = ${sum}/${den}`
                            };
                        },
                        () => {
                            const num = random(2, 10);
                            const den = random(3, 12);
                            const simplified = simplify(num, den);
                            return {
                                question: `Simplify: ${num}/${den}`,
                                answer: `Divide both by ${gcd(num, den)}: ${num}/${den} = ${simplified.num}/${simplified.den}`
                            };
                        },
                        () => {
                            const num1 = random(1, 6);
                            const den = random(4, 10);
                            const num2 = random(1, 6);
                            const result = num1 + num2;
                            return {
                                question: `${num1}/${den} + ${num2}/${den} = ?`,
                                answer: `Add numerators: ${num1} + ${num2} = ${result}\nAnswer: ${result}/${den}`
                            };
                        },
                        () => {
                            const num1 = random(8, 15);
                            const num2 = random(2, 7);
                            const den = random(5, 12);
                            return {
                                question: `Subtract: ${num1}/${den} - ${num2}/${den}`,
                                answer: `${num1}/${den} - ${num2}/${den} = ${num1 - num2}/${den}`
                            };
                        },
                        () => {
                            const whole = random(1, 5);
                            const num = random(1, 7);
                            const den = random(2, 10);
                            return {
                                question: `Convert mixed number to improper fraction: ${whole} ${num}/${den}`,
                                answer: `${whole} ${num}/${den} = (${whole} Ã— ${den} + ${num})/${den} = ${whole * den + num}/${den}`
                            };
                        },
                        () => {
                            const num1 = random(2, 8);
                            const num2 = random(2, 8);
                            const den = 10;
                            return {
                                question: `Add: ${num1}/${den} + ${num2}/${den}`,
                                answer: `${num1}/${den} + ${num2}/${den} = ${num1 + num2}/${den} = ${(num1 + num2) / 10}`
                            };
                        },
                        () => {
                            const num = random(3, 9);
                            const den = random(6, 15);
                            return {
                                question: `Which is greater: ${num}/${den} or ${num + 2}/${den}?`,
                                answer: `${num + 2}/${den} is greater (larger numerator, same denominator)`
                            };
                        },
                        () => {
                            const num1 = random(1, 4);
                            const num2 = random(1, 4);
                            const den = random(5, 9);
                            const total = num1 + num2;
                            const simplified = simplify(total, den);
                            return {
                                question: `Rani ate ${num1}/${den} of a pizza and Ravi ate ${num2}/${den}. How much pizza did they eat together?`,
                                answer: `Total = ${num1}/${den} + ${num2}/${den} = ${total}/${den}${simplified.den !== den ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        }
                    ];
                    return easyProblems[questionNum % easyProblems.length]();
                    
                } else if (difficulty === 'medium') {
                    // MEDIUM: Mix of LIKE and UNLIKE fractions
                    const mediumProblems = [
                        () => {
                            // Unlike fractions with related denominators (one is multiple of other)
                            const den1 = random(2, 6);
                            const den2 = den1 * 2; // 4, 6, 8, 10, 12
                            const num1 = random(1, den1 - 1);
                            const num2 = random(1, den2 - 1);
                            const lcm = den2;
                            const newNum1 = num1 * 2;
                            const sum = newNum1 + num2;
                            const simplified = simplify(sum, lcm);
                            return {
                                question: `Add: ${num1}/${den1} + ${num2}/${den2}`,
                                answer: `LCM of ${den1} and ${den2} = ${lcm}\n${num1}/${den1} = ${newNum1}/${lcm}\n${newNum1}/${lcm} + ${num2}/${den2} = ${sum}/${lcm}${simplified.den !== lcm ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        },
                        () => {
                            // Unlike fractions - simple LCM
                            const den1 = random(3, 6);
                            const den2 = random(4, 8);
                            if (den1 === den2) { den2 = den1 + 2; }
                            const num1 = random(1, den1 - 1);
                            const num2 = random(1, den2 - 1);
                            const lcm = (den1 * den2) / gcd(den1, den2);
                            const newNum1 = num1 * (lcm / den1);
                            const newNum2 = num2 * (lcm / den2);
                            const sum = newNum1 + newNum2;
                            return {
                                question: `Add: ${num1}/${den1} + ${num2}/${den2}`,
                                answer: `LCM = ${lcm}\n${num1}/${den1} = ${newNum1}/${lcm}, ${num2}/${den2} = ${newNum2}/${lcm}\nSum = ${sum}/${lcm}`
                            };
                        },
                        () => {
                            // Subtraction with unlike denominators
                            const den1 = random(3, 7);
                            const den2 = den1 * 2;
                            const num1 = random(3, den1 - 1);
                            const num2 = random(1, den2 - 1);
                            const lcm = den2;
                            const newNum1 = num1 * 2;
                            const diff = newNum1 - num2;
                            return {
                                question: `Subtract: ${num1}/${den1} - ${num2}/${den2}`,
                                answer: `LCM = ${lcm}\n${num1}/${den1} = ${newNum1}/${lcm}\n${newNum1}/${lcm} - ${num2}/${den2} = ${diff}/${lcm}`
                            };
                        },
                        () => {
                            // Compare unlike fractions
                            const den1 = random(3, 8);
                            const den2 = random(4, 9);
                            if (den1 === den2) { den2 = den1 + 1; }
                            const num1 = random(2, den1 - 1);
                            const num2 = random(2, den2 - 1);
                            const lcm = (den1 * den2) / gcd(den1, den2);
                            const newNum1 = num1 * (lcm / den1);
                            const newNum2 = num2 * (lcm / den2);
                            const greater = newNum1 > newNum2 ? `${num1}/${den1}` : `${num2}/${den2}`;
                            return {
                                question: `Which is greater: ${num1}/${den1} or ${num2}/${den2}?`,
                                answer: `Convert to same denominator (${lcm}):\n${num1}/${den1} = ${newNum1}/${lcm}\n${num2}/${den2} = ${newNum2}/${lcm}\n${greater} is greater`
                            };
                        },
                        () => {
                            // Like fractions but needs simplification
                            const den = random(8, 20);
                            const num1 = random(3, den - 2);
                            const num2 = random(3, den - num1);
                            const sum = num1 + num2;
                            const simplified = simplify(sum, den);
                            return {
                                question: `Add and simplify: ${num1}/${den} + ${num2}/${den}`,
                                answer: `${num1}/${den} + ${num2}/${den} = ${sum}/${den} = ${simplified.num}/${simplified.den}`
                            };
                        },
                        () => {
                            // Three fractions with same denominator
                            const den = random(6, 12);
                            const num1 = random(1, 4);
                            const num2 = random(1, 4);
                            const num3 = random(1, 4);
                            const sum = num1 + num2 + num3;
                            const simplified = simplify(sum, den);
                            return {
                                question: `Add: ${num1}/${den} + ${num2}/${den} + ${num3}/${den}`,
                                answer: `Sum = ${sum}/${den}${simplified.den !== den ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        },
                        () => {
                            // Convert improper to mixed
                            const den = random(3, 8);
                            const num = random(den + 1, den * 3);
                            const whole = Math.floor(num / den);
                            const remainder = num % den;
                            return {
                                question: `Convert to mixed number: ${num}/${den}`,
                                answer: `${num} Ã· ${den} = ${whole} remainder ${remainder}\nMixed number = ${whole} ${remainder}/${den}`
                            };
                        },
                        () => {
                            // Word problem - like fractions
                            const den = random(5, 10);
                            const num1 = random(2, den - 2);
                            const num2 = random(1, den - num1);
                            const total = num1 + num2;
                            return {
                                question: `Ram walked ${num1}/${den} km and then ${num2}/${den} km. What is the total distance?`,
                                answer: `Total = ${num1}/${den} + ${num2}/${den} = ${total}/${den} km`
                            };
                        },
                        () => {
                            // Unlike fractions - denominators 2 and 3
                            const num1 = 1;
                            const den1 = 2;
                            const num2 = 1;
                            const den2 = 3;
                            const lcm = 6;
                            return {
                                question: `Add: 1/2 + 1/3`,
                                answer: `LCM = 6\n1/2 = 3/6\n1/3 = 2/6\nSum = 5/6`
                            };
                        },
                        () => {
                            // Subtraction word problem - unlike fractions
                            const den1 = 2;
                            const den2 = 4;
                            const num1 = 1;
                            const num2 = 1;
                            return {
                                question: `A bottle had 1/2 liter water. If 1/4 liter was drunk, how much is left?`,
                                answer: `1/2 - 1/4 = 2/4 - 1/4 = 1/4 liter`
                            };
                        }
                    ];
                    return mediumProblems[questionNum % mediumProblems.length]();
                    
                } else { // hard
                    // HARD: Mostly UNLIKE fractions with larger numbers
                    const hardProblems = [
                        () => {
                            // Unlike fractions with no common factors
                            const den1 = random(5, 12);
                            const den2 = random(7, 15);
                            while (gcd(den1, den2) > 1) { den2 = random(7, 15); }
                            const num1 = random(2, den1 - 1);
                            const num2 = random(2, den2 - 1);
                            const lcm = (den1 * den2) / gcd(den1, den2);
                            const newNum1 = num1 * (lcm / den1);
                            const newNum2 = num2 * (lcm / den2);
                            const sum = newNum1 + newNum2;
                            const simplified = simplify(sum, lcm);
                            return {
                                question: `Add: ${num1}/${den1} + ${num2}/${den2}`,
                                answer: `LCM of ${den1} and ${den2} = ${lcm}\n${num1}/${den1} = ${newNum1}/${lcm}\n${num2}/${den2} = ${newNum2}/${lcm}\nSum = ${sum}/${lcm}${simplified.den !== lcm ? ` = ${simplified.num}/${simplified.den}` : ''}`
                            };
                        },
                        () => {
                            // Three unlike fractions
                            const den1 = random(3, 6);
                            const den2 = random(4, 8);
                            const den3 = random(5, 10);
                            const num1 = random(1, den1 - 1);
                            const num2 = random(1, den2 - 1);
                            const num3 = random(1, den3 - 1);
                            const lcm12 = (den1 * den2) / gcd(den1, den2);
                            const lcm = (lcm12 * den3) / gcd(lcm12, den3);
                            return {
                                question: `Add: ${num1}/${den1} + ${num2}/${den2} + ${num3}/${den3}`,
                                answer: `LCM of ${den1}, ${den2}, ${den3} = ${lcm}\nConvert all to denominator ${lcm} and add numerators`
                            };
                        },
                        () => {
                            // Subtraction with unlike denominators - larger numbers
                            const den1 = random(8, 15);
                            const den2 = random(6, 12);
                            const num1 = random(5, den1 - 1);
                            const num2 = random(2, den2 - 1);
                            const lcm = (den1 * den2) / gcd(den1, den2);
                            const newNum1 = num1 * (lcm / den1);
                            const newNum2 = num2 * (lcm / den2);
                            const diff = newNum1 - newNum2;
                            return {
                                question: `Subtract: ${num1}/${den1} - ${num2}/${den2}`,
                                answer: `LCM = ${lcm}\n${num1}/${den1} = ${newNum1}/${lcm}\n${num2}/${den2} = ${newNum2}/${lcm}\nDifference = ${diff}/${lcm}`
                            };
                        },
                        () => {
                            // Mixed number addition
                            const whole1 = random(1, 4);
                            const whole2 = random(1, 4);
                            const den1 = random(3, 8);
                            const den2 = random(4, 9);
                            const num1 = random(1, den1 - 1);
                            const num2 = random(1, den2 - 1);
                            return {
                                question: `Add: ${whole1} ${num1}/${den1} + ${whole2} ${num2}/${den2}`,
                                answer: `Step 1: Add whole numbers: ${whole1} + ${whole2} = ${whole1 + whole2}\nStep 2: Add fractions: ${num1}/${den1} + ${num2}/${den2} (find LCM)\nStep 3: Combine whole and fraction parts`
                            };
                        },
                        () => {
                            // Complex simplification
                            const den = random(12, 24);
                            const num1 = random(6, den - 3);
                            const num2 = random(3, den - num1);
                            const sum = num1 + num2;
                            const simplified = simplify(sum, den);
                            return {
                                question: `Add and simplify completely: ${num1}/${den} + ${num2}/${den}`,
                                answer: `${num1}/${den} + ${num2}/${den} = ${sum}/${den}\nGCD of ${sum} and ${den} = ${gcd(sum, den)}\nSimplified = ${simplified.num}/${simplified.den}`
                            };
                        },
                        () => {
                            // Word problem - complex unlike fractions
                            const den1 = 5;
                            const den2 = 8;
                            const num1 = 3;
                            const num2 = 5;
                            const lcm = 40;
                            return {
                                question: `A tank has 3/5 water and 5/8 of another liquid. If mixed, what fraction of the total is the mixture? (Assuming tank can hold both)`,
                                answer: `Total = 3/5 + 5/8\nLCM = 40\n3/5 = 24/40\n5/8 = 25/40\nTotal = 49/40 = 1 9/40 (more than full tank!)`
                            };
                        },
                        () => {
                            // Ascending order of unlike fractions
                            const f1 = { n: 2, d: 5 };
                            const f2 = { n: 3, d: 7 };
                            const f3 = { n: 4, d: 9 };
                            return {
                                question: `Arrange in ascending order: 2/5, 3/7, 4/9`,
                                answer: `LCM of 5, 7, 9 = 315\n2/5 = 126/315\n3/7 = 135/315\n4/9 = 140/315\nAscending: 2/5 < 3/7 < 4/9`
                            };
                        },
                        () => {
                            // Fraction of a fraction
                            const whole = random(40, 100);
                            const num1 = random(1, 4);
                            const den1 = random(3, 6);
                            const num2 = random(1, 3);
                            const den2 = random(2, 5);
                            const result = Math.floor((whole * num1 * num2) / (den1 * den2));
                            return {
                                question: `Find ${num1}/${den1} of ${num2}/${den2} of ${whole}`,
                                answer: `First find ${num2}/${den2} of ${whole} = ${Math.floor(whole * num2 / den2)}\nThen find ${num1}/${den1} of that = approximately ${result}`
                            };
                        },
                        () => {
                            // Mixed to improper with operations
                            const whole = random(2, 5);
                            const num = random(2, 7);
                            const den = random(4, 10);
                            const improper = whole * den + num;
                            const num2 = random(1, den - 1);
                            return {
                                question: `Convert ${whole} ${num}/${den} to improper fraction and add ${num2}/${den}`,
                                answer: `${whole} ${num}/${den} = ${improper}/${den}\n${improper}/${den} + ${num2}/${den} = ${improper + num2}/${den}`
                            };
                        },
                        () => {
                            // Complex word problem
                            const total = random(60, 120);
                            const num1 = random(1, 4);
                            const den1 = random(3, 8);
                            const spent = Math.floor(total * num1 / den1);
                            const left = total - spent;
                            return {
                                question: `Ravi had â‚¹${total}. He spent ${num1}/${den1} of it. How much money is left?`,
                                answer: `Amount spent = ${num1}/${den1} Ã— ${total} = â‚¹${spent}\nMoney left = ${total} - ${spent} = â‚¹${left}`
                            };
                        }
                    ];
                    return hardProblems[questionNum % hardProblems.length]();
                }
            }
            
            // DECIMALS
            if (topic.includes('Decimal')) {
                const a = (random(10, 100) / 10).toFixed(1);
                const b = (random(10, 100) / 10).toFixed(1);
                if (questionNum % 2 === 0) {
                    return {
                        question: `Calculate: ${a} + ${b}`,
                        answer: `${a} + ${b} = ${(parseFloat(a) + parseFloat(b)).toFixed(1)}`
                    };
                } else {
                    return {
                        question: `Calculate: ${a} Ã— ${b}`,
                        answer: `${a} Ã— ${b} = ${(parseFloat(a) * parseFloat(b)).toFixed(2)}`
                    };
                }
            }
            
            // PERCENTAGE
            if (topic.includes('Percentage') || topic.includes('Profit')) {
                if (difficulty === 'easy') {
                    const problems = [
                        () => {
                            const percent = random(10, 50) * 2; // 10, 20, 30, 40, 50
                            const total = random(20, 100);
                            const value = Math.floor((total * percent) / 100);
                            return {
                                question: `What is ${percent}% of ${total}?`,
                                answer: `${percent}% of ${total} = (${percent}/100) Ã— ${total} = ${value}`
                            };
                        },
                        () => {
                            const percent = 50;
                            const total = random(20, 100);
                            return {
                                question: `Find ${percent}% of ${total}`,
                                answer: `${percent}% of ${total} = ${total / 2}`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else if (difficulty === 'medium') {
                    const problems = [
                        () => {
                            const total = random(100, 500);
                            const percent = random(15, 85);
                            const value = Math.floor((total * percent) / 100);
                            return {
                                question: `What is ${percent}% of ${total}?`,
                                answer: `${percent}% of ${total} = (${percent}/100) Ã— ${total} = ${value}`
                            };
                        },
                        () => {
                            const cp = random(200, 1000);
                            const profit = random(50, 200);
                            const sp = cp + profit;
                            const profitPercent = Math.floor((profit / cp) * 100);
                            return {
                                question: `An item is bought for â‚¹${cp} and sold for â‚¹${sp}. Find the profit percentage.`,
                                answer: `Profit = â‚¹${sp} - â‚¹${cp} = â‚¹${profit}\nProfit% = (${profit}/${cp}) Ã— 100 = ${profitPercent}%`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else { // hard
                    const problems = [
                        () => {
                            const cp = random(1000, 5000);
                            const lossPercent = random(10, 30);
                            const loss = Math.floor((cp * lossPercent) / 100);
                            const sp = cp - loss;
                            return {
                                question: `A shopkeeper bought an item for â‚¹${cp}. He sold it at a loss of ${lossPercent}%. Find the selling price.`,
                                answer: `Loss = ${lossPercent}% of â‚¹${cp} = (${lossPercent}/100) Ã— ${cp} = â‚¹${loss}\nSelling Price = â‚¹${cp} - â‚¹${loss} = â‚¹${sp}`
                            };
                        },
                        () => {
                            const price = random(500, 3000);
                            const discount = random(10, 40);
                            const discountAmount = Math.floor((price * discount) / 100);
                            const finalPrice = price - discountAmount;
                            return {
                                question: `A jacket marked â‚¹${price} is sold at ${discount}% discount. What is the sale price?`,
                                answer: `Discount = ${discount}% of â‚¹${price} = â‚¹${discountAmount}\nSale Price = â‚¹${price} - â‚¹${discountAmount} = â‚¹${finalPrice}`
                            };
                        },
                        () => {
                            const totalStudents = random(200, 500);
                            const passedPercent = random(60, 95);
                            const passed = Math.floor((totalStudents * passedPercent) / 100);
                            const failed = totalStudents - passed;
                            return {
                                question: `In a school of ${totalStudents} students, ${passedPercent}% passed the exam. How many students failed?`,
                                answer: `Passed = ${passedPercent}% of ${totalStudents} = ${passed} students\nFailed = ${totalStudents} - ${passed} = ${failed} students`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                }
            }
            
            // MENSURATION - Volume, Surface Area (Classes 5-8)
            if (topic.includes('Mensuration') || topic.includes('Volume') || topic.includes('Surface')) {
                if (difficulty === 'easy') {
                    const easyMensurationProblems = [
                        () => {
                            const length = random(5, 15);
                            const width = random(4, 12);
                            const height = random(3, 10);
                            return {
                                question: `Find the volume of a cuboid with length ${length} cm, width ${width} cm, and height ${height} cm.`,
                                answer: `Volume = length Ã— width Ã— height = ${length} Ã— ${width} Ã— ${height} = ${length * width * height} cmÂ³`
                            };
                        },
                        () => {
                            const side = random(4, 12);
                            return {
                                question: `Find the volume of a cube with side ${side} cm.`,
                                answer: `Volume of cube = sideÂ³ = ${side}Â³ = ${side * side * side} cmÂ³`
                            };
                        },
                        () => {
                            const length = random(8, 20);
                            const width = random(6, 15);
                            const height = random(5, 12);
                            const surfaceArea = 2 * (length * width + width * height + height * length);
                            return {
                                question: `Find the surface area of a cuboid: length ${length} cm, width ${width} cm, height ${height} cm.`,
                                answer: `Surface Area = 2(lb + bh + hl)\n= 2(${length}Ã—${width} + ${width}Ã—${height} + ${height}Ã—${length})\n= 2(${length * width} + ${width * height} + ${height * length})\n= ${surfaceArea} cmÂ²`
                            };
                        },
                        () => {
                            const side = random(5, 12);
                            return {
                                question: `Find the surface area of a cube with side ${side} cm.`,
                                answer: `Surface area of cube = 6 Ã— sideÂ²\n= 6 Ã— ${side}Â² = 6 Ã— ${side * side} = ${6 * side * side} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(3, 10);
                            const height = random(8, 20);
                            const volume = Math.floor(3.14 * radius * radius * height);
                            return {
                                question: `Find the volume of a cylinder with radius ${radius} cm and height ${height} cm. (Use Ï€ = 3.14)`,
                                answer: `Volume = Ï€rÂ²h = 3.14 Ã— ${radius}Â² Ã— ${height}\n= 3.14 Ã— ${radius * radius} Ã— ${height} = ${volume} cmÂ³`
                            };
                        },
                        () => {
                            const length = random(6, 15);
                            const width = random(5, 12);
                            return {
                                question: `A room is ${length} m long and ${width} m wide. Find the area of its floor.`,
                                answer: `Area of floor = length Ã— width = ${length} Ã— ${width} = ${length * width} mÂ²`
                            };
                        },
                        () => {
                            const side = random(8, 20);
                            return {
                                question: `Find the perimeter of a square with side ${side} cm.`,
                                answer: `Perimeter of square = 4 Ã— side = 4 Ã— ${side} = ${4 * side} cm`
                            };
                        },
                        () => {
                            const length = random(10, 25);
                            const width = random(6, 18);
                            return {
                                question: `Find the perimeter of a rectangle with length ${length} cm and width ${width} cm.`,
                                answer: `Perimeter = 2(length + width) = 2(${length} + ${width}) = ${2 * (length + width)} cm`
                            };
                        },
                        () => {
                            const base = random(8, 20);
                            const height = random(6, 15);
                            return {
                                question: `Find the area of a triangle with base ${base} cm and height ${height} cm.`,
                                answer: `Area of triangle = (1/2) Ã— base Ã— height\n= (1/2) Ã— ${base} Ã— ${height} = ${(base * height) / 2} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(4, 12);
                            const area = Math.floor(3.14 * radius * radius);
                            return {
                                question: `Find the area of a circle with radius ${radius} cm. (Use Ï€ = 3.14)`,
                                answer: `Area = Ï€rÂ² = 3.14 Ã— ${radius}Â² = 3.14 Ã— ${radius * radius} = ${area} cmÂ²`
                            };
                        }
                    ];
                    return easyMensurationProblems[questionNum % easyMensurationProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumMensurationProblems = [
                        () => {
                            const length = random(12, 30);
                            const width = random(8, 20);
                            const height = random(6, 18);
                            const volume = length * width * height;
                            const surfaceArea = 2 * (length * width + width * height + height * length);
                            return {
                                question: `A cuboid has dimensions ${length} cm Ã— ${width} cm Ã— ${height} cm. Find both volume and surface area.`,
                                answer: `Volume = ${length} Ã— ${width} Ã— ${height} = ${volume} cmÂ³\nSurface Area = 2(${length * width} + ${width * height} + ${height * length}) = ${surfaceArea} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(7, 14);
                            const height = random(15, 30);
                            const volume = Math.floor(3.14 * radius * radius * height);
                            const curvedSA = Math.floor(2 * 3.14 * radius * height);
                            return {
                                question: `Find the curved surface area of a cylinder with radius ${radius} cm and height ${height} cm.`,
                                answer: `Curved Surface Area = 2Ï€rh = 2 Ã— 3.14 Ã— ${radius} Ã— ${height} = ${curvedSA} cmÂ²`
                            };
                        },
                        () => {
                            const side1 = random(8, 15);
                            const side2 = random(10, 20);
                            const side3 = random(12, 22);
                            const s = (side1 + side2 + side3) / 2;
                            const area = Math.floor(Math.sqrt(s * (s - side1) * (s - side2) * (s - side3)));
                            return {
                                question: `Find the area of a triangle with sides ${side1} cm, ${side2} cm, and ${side3} cm using Heron's formula.`,
                                answer: `s = (${side1} + ${side2} + ${side3})/2 = ${s}\nArea = âˆš[s(s-a)(s-b)(s-c)] â‰ˆ ${area} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(6, 15);
                            const circumference = Math.floor(2 * 3.14 * radius);
                            return {
                                question: `Find the circumference of a circle with radius ${radius} cm.`,
                                answer: `Circumference = 2Ï€r = 2 Ã— 3.14 Ã— ${radius} = ${circumference} cm`
                            };
                        },
                        () => {
                            const diagonal1 = random(10, 20);
                            const diagonal2 = random(8, 18);
                            const area = (diagonal1 * diagonal2) / 2;
                            return {
                                question: `Find the area of a rhombus with diagonals ${diagonal1} cm and ${diagonal2} cm.`,
                                answer: `Area = (1/2) Ã— dâ‚ Ã— dâ‚‚ = (1/2) Ã— ${diagonal1} Ã— ${diagonal2} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const parallel1 = random(10, 20);
                            const parallel2 = random(15, 25);
                            const height = random(8, 16);
                            const area = ((parallel1 + parallel2) * height) / 2;
                            return {
                                question: `Find the area of a trapezium with parallel sides ${parallel1} cm and ${parallel2} cm, and height ${height} cm.`,
                                answer: `Area = (1/2) Ã— (a + b) Ã— h = (1/2) Ã— (${parallel1} + ${parallel2}) Ã— ${height} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const length = random(20, 50);
                            const width = random(15, 40);
                            const height = random(4, 8);
                            const wallArea = 2 * height * (length + width);
                            return {
                                question: `A room is ${length} m long, ${width} m wide, and ${height} m high. Find the area of four walls.`,
                                answer: `Area of four walls = 2h(l + w)\n= 2 Ã— ${height} Ã— (${length} + ${width}) = ${wallArea} mÂ²`
                            };
                        },
                        () => {
                            const radius = random(5, 12);
                            const area = Math.floor(3.14 * radius * radius);
                            const circumference = Math.floor(2 * 3.14 * radius);
                            return {
                                question: `A circle has radius ${radius} cm. Find both area and circumference.`,
                                answer: `Area = Ï€rÂ² = 3.14 Ã— ${radius}Â² = ${area} cmÂ²\nCircumference = 2Ï€r = 2 Ã— 3.14 Ã— ${radius} = ${circumference} cm`
                            };
                        },
                        () => {
                            const side = random(10, 25);
                            const volume = side * side * side;
                            const surfaceArea = 6 * side * side;
                            return {
                                question: `A cube has side ${side} cm. Find volume and total surface area.`,
                                answer: `Volume = ${side}Â³ = ${volume} cmÂ³\nSurface Area = 6 Ã— ${side}Â² = ${surfaceArea} cmÂ²`
                            };
                        },
                        () => {
                            const length = random(25, 50);
                            const width = random(18, 35);
                            const pathWidth = random(2, 5);
                            const pathArea = pathWidth * (2 * (length + width) - 4 * pathWidth);
                            return {
                                question: `A ${length} m Ã— ${width} m garden has a ${pathWidth} m wide path around it. Find the area of the path.`,
                                answer: `Outer area = ${length + 2 * pathWidth} Ã— ${width + 2 * pathWidth}\nInner area = ${length} Ã— ${width}\nPath area â‰ˆ ${pathArea} mÂ²`
                            };
                        }
                    ];
                    return mediumMensurationProblems[questionNum % mediumMensurationProblems.length]();
                } else { // hard
                    // For hard, use similar problems with larger numbers and more complexity
                    return mediumMensurationProblems[questionNum % mediumMensurationProblems.length]();
                }
            }
            
            // PERIMETER AND AREA (All Classes)
            if (topic.includes('Perimeter') || topic.includes('Area')) {
                if (difficulty === 'easy') {
                    const easyAreaProblems = [
                        () => {
                            const length = random(5, 15);
                            const width = random(3, 10);
                            return {
                                question: `A rectangle has length ${length} cm and width ${width} cm. Find its perimeter.`,
                                answer: `Perimeter = 2(l + w) = 2(${length} + ${width}) = 2(${length + width}) = ${2 * (length + width)} cm`
                            };
                        },
                        () => {
                            const length = random(5, 15);
                            const width = random(3, 10);
                            return {
                                question: `A rectangle has length ${length} cm and width ${width} cm. Find its area.`,
                                answer: `Area = length Ã— width = ${length} Ã— ${width} = ${length * width} cmÂ²`
                            };
                        },
                        () => {
                            const side = random(5, 15);
                            return {
                                question: `Find the perimeter of a square with side ${side} cm.`,
                                answer: `Perimeter = 4 Ã— side = 4 Ã— ${side} = ${4 * side} cm`
                            };
                        },
                        () => {
                            const side = random(4, 12);
                            return {
                                question: `Find the area of a square with side ${side} cm.`,
                                answer: `Area = side Ã— side = ${side} Ã— ${side} = ${side * side} cmÂ²`
                            };
                        },
                        () => {
                            const base = random(6, 15);
                            const height = random(4, 12);
                            return {
                                question: `Find the area of a triangle with base ${base} cm and height ${height} cm.`,
                                answer: `Area = (1/2) Ã— base Ã— height = (1/2) Ã— ${base} Ã— ${height} = ${(base * height) / 2} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(4, 10);
                            const area = Math.floor(3.14 * radius * radius);
                            return {
                                question: `Find the area of a circle with radius ${radius} cm. (Use Ï€ = 3.14)`,
                                answer: `Area = Ï€rÂ² = 3.14 Ã— ${radius}Â² = 3.14 Ã— ${radius * radius} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(5, 12);
                            const circumference = Math.floor(2 * 3.14 * radius);
                            return {
                                question: `Find the circumference of a circle with radius ${radius} cm. (Use Ï€ = 3.14)`,
                                answer: `Circumference = 2Ï€r = 2 Ã— 3.14 Ã— ${radius} = ${circumference} cm`
                            };
                        },
                        () => {
                            const side1 = random(5, 10);
                            const side2 = random(6, 12);
                            const side3 = random(7, 13);
                            return {
                                question: `Find the perimeter of a triangle with sides ${side1} cm, ${side2} cm, and ${side3} cm.`,
                                answer: `Perimeter = ${side1} + ${side2} + ${side3} = ${side1 + side2 + side3} cm`
                            };
                        },
                        () => {
                            const base = random(8, 16);
                            const height = random(5, 12);
                            return {
                                question: `Find the area of a parallelogram with base ${base} cm and height ${height} cm.`,
                                answer: `Area = base Ã— height = ${base} Ã— ${height} = ${base * height} cmÂ²`
                            };
                        },
                        () => {
                            const length = random(10, 20);
                            const width = random(6, 15);
                            const perimeter = 2 * (length + width);
                            const area = length * width;
                            return {
                                question: `A rectangle is ${length} m long and ${width} m wide. Find both perimeter and area.`,
                                answer: `Perimeter = 2(${length} + ${width}) = ${perimeter} m\nArea = ${length} Ã— ${width} = ${area} mÂ²`
                            };
                        }
                    ];
                    return easyAreaProblems[questionNum % easyAreaProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumAreaProblems = [
                        () => {
                            const side = random(8, 20);
                            const perimeter = 4 * side;
                            const area = side * side;
                            return {
                                question: `A square has side ${side} cm. Find both its perimeter and area.`,
                                answer: `Perimeter = 4 Ã— ${side} = ${perimeter} cm\nArea = ${side}Â² = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const side1 = random(8, 15);
                            const side2 = random(10, 18);
                            const side3 = random(12, 20);
                            const s = (side1 + side2 + side3) / 2;
                            const area = Math.floor(Math.sqrt(s * (s - side1) * (s - side2) * (s - side3)));
                            return {
                                question: `Find the area of a triangle with sides ${side1} cm, ${side2} cm, and ${side3} cm using Heron's formula.`,
                                answer: `s = (${side1} + ${side2} + ${side3})/2 = ${s} cm\nArea = âˆš[s(s-a)(s-b)(s-c)] â‰ˆ ${area} cmÂ²`
                            };
                        },
                        () => {
                            const diagonal1 = random(10, 20);
                            const diagonal2 = random(8, 18);
                            const area = (diagonal1 * diagonal2) / 2;
                            return {
                                question: `Find the area of a rhombus with diagonals ${diagonal1} cm and ${diagonal2} cm.`,
                                answer: `Area = (1/2) Ã— dâ‚ Ã— dâ‚‚ = (1/2) Ã— ${diagonal1} Ã— ${diagonal2} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const parallel1 = random(10, 20);
                            const parallel2 = random(15, 25);
                            const height = random(8, 16);
                            const area = ((parallel1 + parallel2) * height) / 2;
                            return {
                                question: `Find the area of a trapezium with parallel sides ${parallel1} cm and ${parallel2} cm, and height ${height} cm.`,
                                answer: `Area = (1/2) Ã— (a + b) Ã— h = (1/2) Ã— (${parallel1} + ${parallel2}) Ã— ${height} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(6, 14);
                            const area = Math.floor(3.14 * radius * radius);
                            const circumference = Math.floor(2 * 3.14 * radius);
                            return {
                                question: `A circle has radius ${radius} cm. Find both area and circumference.`,
                                answer: `Area = Ï€rÂ² = 3.14 Ã— ${radius}Â² = ${area} cmÂ²\nCircumference = 2Ï€r = 2 Ã— 3.14 Ã— ${radius} = ${circumference} cm`
                            };
                        },
                        () => {
                            const length = random(20, 40);
                            const width = random(15, 30);
                            const height = random(3, 6);
                            const wallArea = 2 * height * (length + width);
                            return {
                                question: `A room is ${length} m long, ${width} m wide, and ${height} m high. Find the area of its four walls.`,
                                answer: `Area of four walls = 2h(l + w) = 2 Ã— ${height} Ã— (${length} + ${width}) = ${wallArea} mÂ²`
                            };
                        },
                        () => {
                            const diameter = random(10, 20);
                            const radius = diameter / 2;
                            const area = Math.floor(3.14 * radius * radius);
                            return {
                                question: `Find the area of a circle with diameter ${diameter} cm.`,
                                answer: `Radius = ${diameter}/2 = ${radius} cm\nArea = Ï€rÂ² = 3.14 Ã— ${radius}Â² = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const side = random(12, 25);
                            const pathWidth = random(2, 5);
                            const outerSide = side + 2 * pathWidth;
                            const pathArea = outerSide * outerSide - side * side;
                            return {
                                question: `A square garden of side ${side} m has a path ${pathWidth} m wide around it. Find the area of the path.`,
                                answer: `Outer square side = ${side} + 2(${pathWidth}) = ${outerSide} m\nPath area = ${outerSide}Â² - ${side}Â² = ${outerSide * outerSide} - ${side * side} = ${pathArea} mÂ²`
                            };
                        },
                        () => {
                            const length = random(25, 50);
                            const width = random(18, 35);
                            const cost = random(10, 30);
                            const area = length * width;
                            const totalCost = area * cost;
                            return {
                                question: `Find the cost of tiling a floor ${length} m Ã— ${width} m at â‚¹${cost} per mÂ².`,
                                answer: `Area = ${length} Ã— ${width} = ${area} mÂ²\nCost = ${area} Ã— â‚¹${cost} = â‚¹${totalCost}`
                            };
                        },
                        () => {
                            const base1 = random(12, 20);
                            const base2 = random(8, 15);
                            const height = random(10, 18);
                            const area1 = (base1 * height) / 2;
                            const area2 = (base2 * height) / 2;
                            const ratio = area1 / area2;
                            return {
                                question: `Two triangles have the same height ${height} cm but bases ${base1} cm and ${base2} cm. Find the ratio of their areas.`,
                                answer: `Areaâ‚ = (1/2) Ã— ${base1} Ã— ${height} = ${area1} cmÂ²\nAreaâ‚‚ = (1/2) Ã— ${base2} Ã— ${height} = ${area2} cmÂ²\nRatio = ${base1}:${base2}`
                            };
                        }
                    ];
                    return mediumAreaProblems[questionNum % mediumAreaProblems.length]();
                } else { // hard
                    const hardAreaProblems = [
                        () => {
                            const length = random(30, 60);
                            const width = random(20, 45);
                            const carpetWidth = random(2, 4);
                            const area = length * width;
                            const carpetLength = area / carpetWidth;
                            return {
                                question: `A hall ${length} m Ã— ${width} m is to be carpeted with carpet ${carpetWidth} m wide. What length of carpet is needed?`,
                                answer: `Area of hall = ${length} Ã— ${width} = ${area} mÂ²\nCarpet length = ${area} Ã· ${carpetWidth} = ${carpetLength} m`
                            };
                        },
                        () => {
                            const outerLength = random(30, 50);
                            const outerWidth = random(20, 40);
                            const pathWidth = random(2, 5);
                            const innerLength = outerLength - 2 * pathWidth;
                            const innerWidth = outerWidth - 2 * pathWidth;
                            const pathArea = outerLength * outerWidth - innerLength * innerWidth;
                            return {
                                question: `A rectangular garden ${outerLength} m Ã— ${outerWidth} m has a path ${pathWidth} m wide running inside along the boundary. Find the area of the path.`,
                                answer: `Inner dimensions = ${innerLength} m Ã— ${innerWidth} m\nPath area = ${outerLength * outerWidth} - ${innerLength * innerWidth} = ${pathArea} mÂ²`
                            };
                        },
                        () => {
                            const radius = random(10, 20);
                            const angle = random(60, 120);
                            const sectorArea = Math.floor((angle / 360) * 3.14 * radius * radius);
                            return {
                                question: `Find the area of a sector of a circle with radius ${radius} cm and central angle ${angle}Â°.`,
                                answer: `Area of sector = (Î¸/360) Ã— Ï€rÂ² = (${angle}/360) Ã— 3.14 Ã— ${radius}Â² â‰ˆ ${sectorArea} cmÂ²`
                            };
                        },
                        () => {
                            const side1 = random(15, 25);
                            const side2 = random(18, 28);
                            const side3 = random(20, 30);
                            const s = (side1 + side2 + side3) / 2;
                            const area = Math.floor(Math.sqrt(s * (s - side1) * (s - side2) * (s - side3)));
                            const perimeter = side1 + side2 + side3;
                            return {
                                question: `Find both perimeter and area of a triangle with sides ${side1} cm, ${side2} cm, and ${side3} cm.`,
                                answer: `Perimeter = ${side1} + ${side2} + ${side3} = ${perimeter} cm\ns = ${perimeter}/2 = ${s}\nArea = âˆš[${s}(${s}-${side1})(${s}-${side2})(${s}-${side3})] â‰ˆ ${area} cmÂ²`
                            };
                        },
                        () => {
                            const outerRadius = random(12, 20);
                            const innerRadius = random(6, outerRadius - 4);
                            const ringArea = Math.floor(3.14 * (outerRadius * outerRadius - innerRadius * innerRadius));
                            return {
                                question: `Find the area of a ring (annulus) with outer radius ${outerRadius} cm and inner radius ${innerRadius} cm.`,
                                answer: `Area = Ï€(RÂ² - rÂ²) = 3.14(${outerRadius}Â² - ${innerRadius}Â²)\n= 3.14(${outerRadius * outerRadius} - ${innerRadius * innerRadius}) = ${ringArea} cmÂ²`
                            };
                        },
                        () => {
                            const radius = random(14, 28);
                            const side = radius;
                            const circleArea = Math.floor(3.14 * radius * radius);
                            const squareArea = side * side;
                            const shadedArea = squareArea - circleArea;
                            return {
                                question: `A circle of radius ${radius} cm is inscribed in a square. Find the area of the shaded region outside the circle.`,
                                answer: `Square side = 2r = ${2 * radius} cm\nSquare area = ${2 * radius}Â² = ${squareArea} cmÂ²\nCircle area = Ï€rÂ² â‰ˆ ${circleArea} cmÂ²\nShaded area = ${squareArea} - ${circleArea} = ${shadedArea} cmÂ²`
                            };
                        },
                        () => {
                            const length = random(40, 80);
                            const width = random(30, 60);
                            const tileSide = random(20, 40);
                            const floorArea = length * width;
                            const tileArea = tileSide * tileSide;
                            const tiles = Math.ceil(floorArea / tileArea);
                            return {
                                question: `How many square tiles of side ${tileSide} cm are needed to cover a floor ${length} cm Ã— ${width} cm?`,
                                answer: `Floor area = ${length} Ã— ${width} = ${floorArea} cmÂ²\nTile area = ${tileSide}Â² = ${tileArea} cmÂ²\nTiles needed = ${floorArea} Ã· ${tileArea} â‰ˆ ${tiles} tiles`
                            };
                        },
                        () => {
                            const base = random(20, 40);
                            const height = random(15, 30);
                            const triangleArea = (base * height) / 2;
                            const newHeight = random(20, 35);
                            const newBase = (2 * triangleArea) / newHeight;
                            return {
                                question: `A triangle has base ${base} cm and height ${height} cm. If the height is changed to ${newHeight} cm, what should be the base to keep the same area?`,
                                answer: `Original area = (1/2) Ã— ${base} Ã— ${height} = ${triangleArea} cmÂ²\nNew base = (2 Ã— ${triangleArea}) Ã· ${newHeight} = ${newBase} cm`
                            };
                        },
                        () => {
                            const parallel1 = random(20, 35);
                            const parallel2 = random(25, 40);
                            const height = random(15, 25);
                            const area = ((parallel1 + parallel2) * height) / 2;
                            const perimeter = parallel1 + parallel2 + 2 * Math.sqrt(height * height + Math.pow((parallel2 - parallel1) / 2, 2));
                            return {
                                question: `Find the area of a trapezium with parallel sides ${parallel1} cm and ${parallel2} cm, and height ${height} cm.`,
                                answer: `Area = (1/2) Ã— (${parallel1} + ${parallel2}) Ã— ${height}\n= (1/2) Ã— ${parallel1 + parallel2} Ã— ${height} = ${area} cmÂ²`
                            };
                        },
                        () => {
                            const side = random(20, 40);
                            const diagonal = Math.floor(side * 1.414);
                            return {
                                question: `Find the diagonal of a square with side ${side} cm. (âˆš2 â‰ˆ 1.414)`,
                                answer: `Diagonal = side Ã— âˆš2 = ${side} Ã— 1.414 â‰ˆ ${diagonal} cm`
                            };
                        }
                    ];
                    return hardAreaProblems[questionNum % hardAreaProblems.length]();
                }
            }
            
            // PROBABILITY (Class 8)
            if (topic.includes('Probability')) {
                if (difficulty === 'easy') {
                    const easyProbProblems = [
                        () => {
                            const total = random(4, 10);
                            const favorable = random(1, total - 1);
                            return {
                                question: `A bag has ${total} balls. ${favorable} are red and the rest are blue. What is the probability of picking a red ball?`,
                                answer: `Probability = Favorable outcomes / Total outcomes = ${favorable}/${total}`
                            };
                        },
                        () => {
                            return {
                                question: `A coin is tossed. What is the probability of getting heads?`,
                                answer: `Probability = 1/2 (There are 2 outcomes: heads or tails, 1 is favorable)`
                            };
                        },
                        () => {
                            return {
                                question: `A die is rolled. What is the probability of getting a 6?`,
                                answer: `Probability = 1/6 (There are 6 faces, 1 shows 6)`
                            };
                        },
                        () => {
                            const total = 52;
                            return {
                                question: `A card is drawn from a deck of ${total} cards. What is the probability of drawing a King? (There are 4 Kings)`,
                                answer: `Probability = 4/52 = 1/13`
                            };
                        },
                        () => {
                            return {
                                question: `A die is rolled. What is the probability of getting an even number?`,
                                answer: `Even numbers: 2, 4, 6 (3 favorable outcomes)\nProbability = 3/6 = 1/2`
                            };
                        },
                        () => {
                            const total = random(6, 12);
                            const red = random(2, total - 2);
                            return {
                                question: `A box has ${total} marbles. ${red} are red. What is the probability of NOT picking a red marble?`,
                                answer: `Non-red marbles = ${total} - ${red} = ${total - red}\nProbability = ${total - red}/${total}`
                            };
                        },
                        () => {
                            return {
                                question: `What is the probability of an impossible event?`,
                                answer: `Probability of impossible event = 0 (It can never happen)`
                            };
                        },
                        () => {
                            return {
                                question: `What is the probability of a certain event?`,
                                answer: `Probability of certain event = 1 (It will always happen)`
                            };
                        },
                        () => {
                            return {
                                question: `A die is rolled. What is the probability of getting a number less than 3?`,
                                answer: `Numbers less than 3: 1, 2 (2 favorable outcomes)\nProbability = 2/6 = 1/3`
                            };
                        },
                        () => {
                            const total = random(8, 15);
                            const green = random(2, 5);
                            return {
                                question: `A jar has ${total} candies. ${green} are green. If you pick one candy at random, what is the probability it is green?`,
                                answer: `Probability = ${green}/${total}`
                            };
                        }
                    ];
                    return easyProbProblems[questionNum % easyProbProblems.length]();
                } else if (difficulty === 'medium') {
                    const mediumProbProblems = [
                        () => {
                            const total = random(10, 20);
                            const red = random(3, 7);
                            const blue = random(3, 7);
                            const green = total - red - blue;
                            return {
                                question: `A bag has ${total} balls: ${red} red, ${blue} blue, and ${green} green. What is the probability of picking a blue ball?`,
                                answer: `Probability = ${blue}/${total}`
                            };
                        },
                        () => {
                            return {
                                question: `Two coins are tossed. What is the probability of getting exactly one head?`,
                                answer: `Possible outcomes: HH, HT, TH, TT (4 total)\nOne head: HT, TH (2 favorable)\nProbability = 2/4 = 1/2`
                            };
                        },
                        () => {
                            return {
                                question: `A die is rolled. What is the probability of getting a prime number?`,
                                answer: `Prime numbers on die: 2, 3, 5 (3 favorable)\nProbability = 3/6 = 1/2`
                            };
                        },
                        () => {
                            return {
                                question: `A card is drawn from a deck. What is the probability it is a heart? (13 hearts in 52 cards)`,
                                answer: `Probability = 13/52 = 1/4`
                            };
                        },
                        () => {
                            const total = random(15, 25);
                            const defective = random(2, 5);
                            const good = total - defective;
                            return {
                                question: `Out of ${total} items, ${defective} are defective. What is the probability of selecting a good item?`,
                                answer: `Good items = ${total} - ${defective} = ${good}\nProbability = ${good}/${total}`
                            };
                        },
                        () => {
                            return {
                                question: `Two dice are rolled. What is the probability that their sum is 7?`,
                                answer: `Favorable outcomes: (1,6), (2,5), (3,4), (4,3), (5,2), (6,1) = 6\nTotal outcomes = 6 Ã— 6 = 36\nProbability = 6/36 = 1/6`
                            };
                        },
                        () => {
                            const students = random(25, 40);
                            const girls = random(10, 20);
                            return {
                                question: `A class has ${students} students. ${girls} are girls. If one student is selected randomly, what is the probability of selecting a boy?`,
                                answer: `Boys = ${students} - ${girls} = ${students - girls}\nProbability = ${students - girls}/${students}`
                            };
                        },
                        () => {
                            return {
                                question: `A bag has 3 red and 5 blue balls. What is the probability of drawing a red ball?`,
                                answer: `Total balls = 3 + 5 = 8\nProbability = 3/8`
                            };
                        },
                        () => {
                            return {
                                question: `A letter is chosen at random from the word "PROBABILITY". What is the probability it is the letter B?`,
                                answer: `Total letters = 11\nLetter B appears = 2 times\nProbability = 2/11`
                            };
                        },
                        () => {
                            return {
                                question: `A die is rolled. Find the probability of getting a number greater than 4.`,
                                answer: `Numbers greater than 4: 5, 6 (2 favorable)\nProbability = 2/6 = 1/3`
                            };
                        }
                    ];
                    return mediumProbProblems[questionNum % mediumProbProblems.length]();
                } else { // hard
                    const hardProbProblems = [
                        () => {
                            return {
                                question: `Three coins are tossed simultaneously. What is the probability of getting at least 2 heads?`,
                                answer: `Total outcomes = 2Â³ = 8: HHH, HHT, HTH, HTT, THH, THT, TTH, TTT\nAt least 2 heads: HHH, HHT, HTH, THH (4 outcomes)\nProbability = 4/8 = 1/2`
                            };
                        },
                        () => {
                            return {
                                question: `Two dice are rolled. What is the probability of getting a sum of 10?`,
                                answer: `Favorable outcomes: (4,6), (5,5), (6,4) = 3\nTotal outcomes = 36\nProbability = 3/36 = 1/12`
                            };
                        },
                        () => {
                            const total = random(30, 50);
                            const red = random(8, 15);
                            const blue = random(8, 15);
                            const green = total - red - blue;
                            return {
                                question: `A bag has ${red} red, ${blue} blue, and ${green} green balls. Two balls are drawn with replacement. What is the probability both are red?`,
                                answer: `P(first red) = ${red}/${total}\nP(second red) = ${red}/${total} (with replacement)\nP(both red) = (${red}/${total}) Ã— (${red}/${total}) = ${red * red}/${total * total}`
                            };
                        },
                        () => {
                            return {
                                question: `A card is drawn from a deck. What is the probability it is either a King or a Heart?`,
                                answer: `Kings = 4, Hearts = 13, King of Hearts = 1 (counted in both)\nFavorable = 4 + 13 - 1 = 16\nProbability = 16/52 = 4/13`
                            };
                        },
                        () => {
                            const boys = random(12, 18);
                            const girls = random(12, 18);
                            const total = boys + girls;
                            return {
                                question: `A class has ${boys} boys and ${girls} girls. Two students are selected at random. What is the probability both are boys? (without replacement)`,
                                answer: `P(first boy) = ${boys}/${total}\nP(second boy) = ${boys - 1}/${total - 1}\nP(both boys) = (${boys}/${total}) Ã— (${boys - 1}/${total - 1})`
                            };
                        },
                        () => {
                            return {
                                question: `A bag has 4 red, 5 blue, and 6 green balls. What is the probability of drawing a non-green ball?`,
                                answer: `Non-green balls = 4 + 5 = 9\nTotal balls = 4 + 5 + 6 = 15\nProbability = 9/15 = 3/5`
                            };
                        },
                        () => {
                            return {
                                question: `Two cards are drawn from a deck without replacement. What is the probability both are Aces?`,
                                answer: `P(first Ace) = 4/52 = 1/13\nP(second Ace) = 3/51 = 1/17\nP(both Aces) = (4/52) Ã— (3/51) = 12/2652 = 1/221`
                            };
                        },
                        () => {
                            return {
                                question: `Three dice are rolled. What is the probability of getting all different numbers?`,
                                answer: `First die: any number = 6/6 = 1\nSecond die: different = 5/6\nThird die: different from both = 4/6\nProbability = 1 Ã— (5/6) Ã— (4/6) = 20/36 = 5/9`
                            };
                        },
                        () => {
                            return {
                                question: `A coin is tossed 4 times. What is the probability of getting exactly 2 heads?`,
                                answer: `Total outcomes = 2â´ = 16\nWays to get 2 heads = C(4,2) = 6\nProbability = 6/16 = 3/8`
                            };
                        },
                        () => {
                            const total = random(40, 60);
                            const passPercent = random(60, 80);
                            const pass = Math.floor(total * passPercent / 100);
                            return {
                                question: `In an exam, ${pass} out of ${total} students passed. What is the probability that a randomly selected student passed?`,
                                answer: `Probability = ${pass}/${total}`
                            };
                        }
                    ];
                    return hardProbProblems[questionNum % hardProbProblems.length]();
                }
            }
            
            // COMPOUND INTEREST (Class 8)
            if (topic.includes('Compound')) {
                if (difficulty === 'easy') {
                    const easyCompoundProblems = [
                        () => {
                            const principal = random(1000, 5000);
                            const rate = random(5, 15);
                            const time = 1;
                            const si = (principal * rate * time) / 100;
                            return {
                                question: `Find the simple interest on â‚¹${principal} at ${rate}% per annum for ${time} year.`,
                                answer: `SI = (P Ã— R Ã— T) / 100 = (${principal} Ã— ${rate} Ã— ${time}) / 100 = â‚¹${si}`
                            };
                        },
                        () => {
                            const principal = random(2000, 8000);
                            const rate = 10;
                            const time = 2;
                            const si = (principal * rate * time) / 100;
                            const amount = principal + si;
                            return {
                                question: `Find the amount on â‚¹${principal} at ${rate}% simple interest for ${time} years.`,
                                answer: `SI = (${principal} Ã— ${rate} Ã— ${time}) / 100 = â‚¹${si}\nAmount = P + SI = â‚¹${principal} + â‚¹${si} = â‚¹${amount}`
                            };
                        },
                        () => {
                            const principal = random(5000, 10000);
                            const rate = random(8, 12);
                            const time = 1;
                            const ci = Math.floor(principal * Math.pow(1 + rate/100, time) - principal);
                            return {
                                question: `Find the compound interest on â‚¹${principal} at ${rate}% per annum for ${time} year (compounded annually).`,
                                answer: `For 1 year, CI = SI = (P Ã— R Ã— T) / 100\nCI = (${principal} Ã— ${rate} Ã— 1) / 100 = â‚¹${ci}`
                            };
                        },
                        () => {
                            const principal = 1000;
                            const rate = 10;
                            const time = 2;
                            const amount = Math.floor(principal * Math.pow(1 + rate/100, time));
                            return {
                                question: `Find the amount on â‚¹${principal} at ${rate}% compound interest for ${time} years.`,
                                answer: `A = P(1 + R/100)^T = ${principal}(1 + ${rate}/100)^${time}\n= ${principal}(1.1)^2 = ${principal} Ã— 1.21 = â‚¹${amount}`
                            };
                        },
                        () => {
                            const principal = random(2000, 5000);
                            const rate = 10;
                            const time = 2;
                            const si = (principal * rate * time) / 100;
                            const ci = Math.floor(principal * Math.pow(1 + rate/100, time) - principal);
                            const diff = ci - si;
                            return {
                                question: `Find the difference between CI and SI on â‚¹${principal} at ${rate}% for ${time} years.`,
                                answer: `CI = P[(1+R/100)^T - 1] = â‚¹${ci}\nSI = (PÃ—RÃ—T)/100 = â‚¹${si}\nDifference = â‚¹${ci} - â‚¹${si} = â‚¹${diff}`
                            };
                        }
                    ];
                    return easyCompoundProblems[questionNum % easyCompoundProblems.length]();
                } else {
                    // For medium and hard, use similar problems with bigger numbers
                    const principal = difficulty === 'medium' ? random(5000, 15000) : random(10000, 50000);
                    const rate = random(8, 15);
                    const time = difficulty === 'medium' ? 2 : 3;
                    const amount = Math.floor(principal * Math.pow(1 + rate/100, time));
                    const ci = amount - principal;
                    return {
                        question: `Find the compound interest on â‚¹${principal} at ${rate}% per annum for ${time} years (compounded annually).`,
                        answer: `A = P(1 + R/100)^T = ${principal}(1 + ${rate}/100)^${time} = â‚¹${amount}\nCI = A - P = â‚¹${amount} - â‚¹${principal} = â‚¹${ci}`
                    };
                }
            }
            
            // CUBES AND CUBE ROOTS (Class 8)
            if (topic.includes('Cube')) {
                const problems = [
                    () => {
                        const n = random(1, 10);
                        const cube = n * n * n;
                        return {
                            question: `Find the cube of ${n}`,
                            answer: `${n}Â³ = ${n} Ã— ${n} Ã— ${n} = ${cube}`
                        };
                    },
                    () => {
                        const n = random(1, 5);
                        const cube = n * n * n;
                        return {
                            question: `Find the cube root of ${cube}`,
                            answer: `âˆ›${cube} = ${n} (because ${n}Â³ = ${cube})`
                        };
                    },
                    () => {
                        const n = random(2, 8);
                        return {
                            question: `Is ${n}Â³ positive or negative? And what is its value?`,
                            answer: `${n}Â³ is positive = ${n * n * n}`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // LINEAR EQUATIONS (Classes 7-8)
            if (topic.includes('Linear') || topic.includes('Equation')) {
                if (difficulty === 'easy') {
                    const problems = [
                        () => {
                            const a = random(2, 10);
                            const b = random(5, 20);
                            const x = random(2, 10);
                            const result = a * x + b;
                            return {
                                question: `Solve for x: ${a}x + ${b} = ${result}`,
                                answer: `${a}x = ${result} - ${b}\n${a}x = ${result - b}\nx = ${(result - b) / a}`
                            };
                        },
                        () => {
                            const a = random(3, 10);
                            const b = random(5, 20);
                            return {
                                question: `Simplify: ${a}x + ${b}x`,
                                answer: `${a}x + ${b}x = ${a + b}x`
                            };
                        },
                        () => {
                            const a = random(2, 8);
                            const c = a * random(3, 10);
                            return {
                                question: `Solve: ${a}x = ${c}`,
                                answer: `x = ${c}/${a} = ${c / a}`
                            };
                        }
                    ];
                    return problems[questionNum % problems.length]();
                } else {
                    const a = random(3, 12);
                    const b = random(5, 25);
                    const c = random(10, 50);
                    return {
                        question: `Solve: ${a}x - ${b} = ${c}`,
                        answer: `${a}x = ${c} + ${b}\n${a}x = ${c + b}\nx = ${(c + b) / a}`
                    };
                }
            }
            
            // RATIONAL NUMBERS (Classes 7-8)
            if (topic.includes('Rational')) {
                const problems = [
                    () => {
                        const num1 = random(1, 10);
                        const den1 = random(2, 12);
                        const num2 = random(1, 10);
                        const den2 = den1; // same denominator for easy
                        return {
                            question: `Add: ${num1}/${den1} + ${num2}/${den2}`,
                            answer: `${num1}/${den1} + ${num2}/${den2} = ${num1 + num2}/${den1}`
                        };
                    },
                    () => {
                        const num = random(2, 10);
                        const den = random(3, 12);
                        return {
                            question: `Is ${num}/${den} a rational number? Why?`,
                            answer: `Yes, ${num}/${den} is a rational number because it can be expressed as p/q where p and q are integers and q â‰  0`
                        };
                    },
                    () => {
                        const num = random(-10, -1);
                        const den = random(2, 10);
                        return {
                            question: `Which is greater: ${num}/${den} or 0?`,
                            answer: `0 is greater because ${num}/${den} is negative`
                        };
                    }
                ];
                return problems[questionNum % problems.length]();
            }
            
            // DEFAULT - BASIC NUMBERS
            const a = random(1, range);
            const b = random(1, range);
            return {
                question: `Calculate: ${a} + ${b}`,
                answer: `${a} + ${b} = ${a + b}`
            };
        };

        const generateProblems = (classNum, topic, difficulty) => {
            const problems = [];
            for (let i = 1; i <= 10; i++) {
                const problem = generateProblem(classNum, topic, difficulty, i);
                problems.push({
                    number: i,
                    question: problem.question,
                    answer: problem.answer,
                    marks: i % 2 === 0 ? 3 : 2
                });
            }
            return problems;
        };

        function App() {
            const [selectedClass, setSelectedClass] = useState(5);
            const [selectedTopic, setSelectedTopic] = useState('');
            const [difficulty, setDifficulty] = useState('medium');
            const [worksheet, setWorksheet] = useState(null);
            const [loading, setLoading] = useState(false);
            const [showAnswers, setShowAnswers] = useState(false);
            const [error, setError] = useState(null);
            const [score, setScore] = useState(0);
            const [showConfetti, setShowConfetti] = useState(false);
            const [userAnswers, setUserAnswers] = useState({});
            const [checkedAnswers, setCheckedAnswers] = useState({});

            useEffect(() => {
                if (worksheet) {
                    setUserAnswers({});
                    setCheckedAnswers({});
                    setShowAnswers(false);
                }
            }, [worksheet]);

            const handleAnswerChange = (questionNumber, value) => {
                setUserAnswers(prev => ({ ...prev, [questionNumber]: value }));
            };

            const checkAnswer = (questionNumber, marks) => {
                if (checkedAnswers[questionNumber]) return;
                setCheckedAnswers(prev => ({ ...prev, [questionNumber]: true }));
                setScore(prev => prev + marks);
                setShowConfetti(true);
                setTimeout(() => setShowConfetti(false), 2000);
            };

            const generateWorksheet = () => {
                if (!selectedTopic) {
                    setError('ðŸŽ¯ Please select a topic first!');
                    return;
                }

                setLoading(true);
                setError(null);

                setTimeout(() => {
                    try {
                        const problems = generateProblems(selectedClass, selectedTopic, difficulty);
                        const totalMarks = problems.reduce((sum, p) => sum + p.marks, 0);
                        
                        setWorksheet({
                            title: `Class ${selectedClass} - ${selectedTopic}`,
                            instructions: 'Solve all problems showing your work.',
                            problems: problems,
                            totalMarks: totalMarks,
                            timeAllocation: '30 minutes'
                        });
                    } catch (err) {
                        setError('ðŸ˜• Oops! Something went wrong. Please try again!');
                    } finally {
                        setLoading(false);
                    }
                }, 800);
            };

            const downloadWorksheet = () => {
                if (!worksheet) return;
                try {
                    const { jsPDF } = window.jspdf;
                    const doc = new jsPDF();
                    
                    let yPos = 20;
                    const pageHeight = doc.internal.pageSize.height;
                    const margin = 20;
                    const lineHeight = 7;
                    
                    // Title
                    doc.setFontSize(18);
                    doc.setFont(undefined, 'bold');
                    doc.text(worksheet.title, margin, yPos);
                    yPos += 10;
                    
                    // Instructions
                    doc.setFontSize(11);
                    doc.setFont(undefined, 'normal');
                    doc.text(`Instructions: ${worksheet.instructions}`, margin, yPos);
                    yPos += 10;
                    
                    // Line separator
                    doc.setLineWidth(0.5);
                    doc.line(margin, yPos, 190, yPos);
                    yPos += 10;
                    
                    // Questions
                    worksheet.problems.forEach((problem, index) => {
                        // Check if we need a new page
                        if (yPos > pageHeight - 60) {
                            doc.addPage();
                            yPos = 20;
                        }
                        
                        // Question number
                        doc.setFontSize(12);
                        doc.setFont(undefined, 'bold');
                        doc.text(`Q${problem.number}.`, margin, yPos);
                        
                        // Question text - handle long questions
                        doc.setFont(undefined, 'normal');
                        const questionLines = doc.splitTextToSize(problem.question, 160);
                        doc.text(questionLines, margin + 15, yPos);
                        yPos += questionLines.length * lineHeight;
                        
                        // Answer space
                        yPos += 5;
                        doc.setFontSize(10);
                        doc.text('Answer: ________________________________', margin + 15, yPos);
                        yPos += 15;
                        
                        // Extra space between questions
                        yPos += 5;
                    });
                    
                    // Add answer key if shown
                    if (showAnswers) {
                        doc.addPage();
                        yPos = 20;
                        
                        doc.setFontSize(16);
                        doc.setFont(undefined, 'bold');
                        doc.text('ANSWER KEY', margin, yPos);
                        yPos += 10;
                        
                        doc.setLineWidth(0.5);
                        doc.line(margin, yPos, 190, yPos);
                        yPos += 10;
                        
                        worksheet.problems.forEach((problem) => {
                            if (yPos > pageHeight - 40) {
                                doc.addPage();
                                yPos = 20;
                            }
                            
                            doc.setFontSize(11);
                            doc.setFont(undefined, 'bold');
                            doc.text(`Q${problem.number}.`, margin, yPos);
                            
                            doc.setFont(undefined, 'normal');
                            const answerLines = doc.splitTextToSize(problem.answer, 160);
                            doc.text(answerLines, margin + 15, yPos);
                            yPos += answerLines.length * lineHeight + 8;
                        });
                    }
                    
                    // Save the PDF
                    const fileName = `CBSE_Class${selectedClass}_${selectedTopic.replace(/\s+/g, '_')}_Worksheet.pdf`;
                    doc.save(fileName);
                    
                } catch (error) {
                    console.error('PDF generation error:', error);
                    alert('PDF download failed. Please try again!');
                }
            };

            return (
                <div style={{position: 'relative', minHeight: '100vh'}}>
                    {/* Background elements */}
                    {mathSymbols.map((symbol, i) => (
                        <div
                            key={i}
                            className="float-symbol"
                            style={{
                                left: `${(i * 5.5) % 95}%`,
                                top: `${(i * 7) % 95}%`,
                                animationDelay: `${i * 0.5}s`
                            }}
                        >
                            {symbol}
                        </div>
                    ))}
                    
                    <div className="bg-circle" style={{top: '40px', left: '40px', width: '128px', height: '128px', background: '#fbbf24'}}></div>
                    <div className="bg-circle" style={{bottom: '80px', right: '80px', width: '160px', height: '160px', background: '#ec4899', animationDelay: '1s'}}></div>
                    <div className="bg-circle" style={{top: '50%', right: '40px', width: '96px', height: '96px', background: '#3b82f6', animationDelay: '2s'}}></div>

                    {/* Confetti */}
                    {showConfetti && (
                        <div style={{position: 'fixed', inset: 0, pointerEvents: 'none', zIndex: 9999}}>
                            {[...Array(50)].map((_, i) => (
                                <div
                                    key={i}
                                    className="confetti"
                                    style={{
                                        left: `${Math.random() * 100}%`,
                                        top: '-10px',
                                        background: ['#FF6B6B', '#4ECDC4', '#FFE66D', '#A8E6CF', '#FF8B94'][Math.floor(Math.random() * 5)],
                                        animationDelay: `${Math.random() * 0.5}s`
                                    }}
                                />
                            ))}
                        </div>
                    )}

                    <div className="container">
                        {/* Header */}
                        <div className="card header-card" style={{display: 'flex', justifyContent: 'center', alignItems: 'center', flexWrap: 'wrap', gap: '16px'}}>
                            <div style={{display: 'flex', alignItems: 'center', gap: '12px'}}>
                                <div className="icon-bounce">ðŸ“š</div>
                                <div>
                                    <h1 className="title">ðŸŽ“ Math Fun Zone! ðŸš€</h1>
                                    <p className="subtitle">Practice & Become a Math Superstar! â­</p>
                                </div>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="card">
                            <div className="grid-3">
                                <div className="form-group">
                                    <label className="form-label">
                                        <span>ðŸ“š</span> Select Class
                                    </label>
                                    <select className="form-select" value={selectedClass} onChange={(e) => {
                                        setSelectedClass(Number(e.target.value));
                                        setSelectedTopic('');
                                        setWorksheet(null);
                                    }}>
                                        {[1,2,3,4,5,6,7,8].map(c => <option key={c} value={c}>Class {c}</option>)}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">
                                        <span>ðŸŽ¯</span> Select Topic
                                    </label>
                                    <select className="form-select" value={selectedTopic} onChange={(e) => {
                                        setSelectedTopic(e.target.value);
                                        setWorksheet(null);
                                    }}>
                                        <option value="">Choose a topic...</option>
                                        {CBSE_TOPICS[selectedClass].map(t => <option key={t} value={t}>{t}</option>)}
                                    </select>
                                </div>

                                <div className="form-group">
                                    <label className="form-label">
                                        <span>âš¡</span> Difficulty Level
                                    </label>
                                    <select className="form-select" value={difficulty} onChange={(e) => setDifficulty(e.target.value)}>
                                        <option value="easy">ðŸ˜Š Easy Peasy</option>
                                        <option value="medium">ðŸ¤” Medium Challenge</option>
                                        <option value="hard">ðŸ”¥ Super Hard</option>
                                    </select>
                                </div>
                            </div>

                            <button className={`btn ${loading || !selectedTopic ? 'btn-disabled' : 'btn-primary'}`} onClick={generateWorksheet} disabled={loading || !selectedTopic}>
                                {loading ? (
                                    <>
                                        <span className="spinner">â³</span>
                                        Creating Magic... âœ¨
                                    </>
                                ) : (
                                    <>
                                        <span>âœ¨</span>
                                        Generate New Worksheet! ðŸŽ‰
                                    </>
                                )}
                            </button>

                            {error && (
                                <div className="alert alert-error">
                                    <span>âš ï¸</span>
                                    <p style={{fontWeight: 500}}>{error}</p>
                                </div>
                            )}
                        </div>

                        {/* Worksheet */}
                        {worksheet && (
                            <div className="card">
                                <div className="worksheet-header">
                                    <h2 className="worksheet-title">{worksheet.title} ðŸŽŠ</h2>
                                    <div>
                                        <span className="info-badge badge-yellow">ðŸ“ {worksheet.instructions}</span>
                                    </div>
                                </div>

                                <div className="button-group">
                                    <button className="btn btn-success" onClick={() => setShowAnswers(!showAnswers)}>
                                        <span>{showAnswers ? 'ðŸ™ˆ' : 'ðŸ‘€'}</span>
                                        {showAnswers ? 'Hide Answers' : 'Show Answers'}
                                    </button>
                                    <button className="btn btn-warning" onClick={downloadWorksheet}>
                                        <span>ðŸ“„</span>
                                        Download PDF
                                    </button>
                                </div>

                                <div>
                                    {worksheet.problems.map((problem) => (
                                        <div key={problem.number} className="question-card">
                                            <div className="question-header">
                                                <div className="question-number">
                                                    <span className="number-badge">{problem.number}</span>
                                                    Question {problem.number}
                                                </div>
                                            </div>
                                            <p className="question-text">{problem.question}</p>

                                            <div className="form-group">
                                                <label className="form-label">âœï¸ Your Answer:</label>
                                                <textarea
                                                    className="form-textarea"
                                                    value={userAnswers[problem.number] || ''}
                                                    onChange={(e) => handleAnswerChange(problem.number, e.target.value)}
                                                    placeholder="Write your answer here..."
                                                    rows="3"
                                                />
                                            </div>

                                            {showAnswers && (
                                                <div className="answer-box">
                                                    <div className="answer-label">
                                                        <span>âš¡</span>
                                                        Correct Answer:
                                                    </div>
                                                    <p className="answer-text">{problem.answer}</p>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Info */}
                        {!worksheet && !loading && (
                            <div className="card">
                                <h3 style={{fontSize: '20px', fontWeight: 'bold', marginBottom: '16px', color: '#059669'}}>
                                    ðŸŽ® How to Use This Amazing App:
                                </h3>
                                <ol className="info-list">
                                    <li>ðŸŽ¯ Select your class level (1-8)</li>
                                    <li>ðŸ“š Choose a fun topic from CBSE curriculum</li>
                                    <li>âš¡ Pick your difficulty level</li>
                                    <li>âœ¨ Click the magical "Generate" button!</li>
                                    <li>âœï¸ Write your answers in the text boxes</li>
                                    <li>ðŸ‘€ Toggle "Show Answers" to see solutions</li>
                                    <li>ðŸ“„ Download as PDF to print and practice offline</li>
                                </ol>
                                <div className="tip-box">
                                    <p className="tip-text">
                                        ðŸ’¡ <strong>Super Tip:</strong> Every worksheet is brand new with random problems! 
                                        Keep generating new worksheets to become a Math Champion! ðŸ† 
                                        Download PDFs to practice anytime, anywhere! ðŸŒŸ
                                    </p>
                                </div>
                            </div>
                        )}
                    </div>
                    
                    {/* Footer */}
                    <div className="card" style={{marginTop: '40px', textAlign: 'center', background: 'linear-gradient(135deg, #f3e8ff 0%, #fce7f3 100%)', borderTop: '4px solid #a855f7'}}>
                        <h3 style={{fontSize: '20px', fontWeight: 'bold', marginBottom: '16px', color: '#7c3aed'}}>
                            ðŸ“§ Contact & Support
                        </h3>
                        <p style={{color: '#374151', marginBottom: '12px', fontSize: '16px'}}>
                            Questions? Feedback? Suggestions?
                        </p>
                        <p style={{marginBottom: '20px'}}>
                            <a href="mailto:mathsbuddy01@gmail.com" style={{color: '#7c3aed', fontWeight: 'bold', fontSize: '18px', textDecoration: 'none'}}>
                                ðŸ“¬ mathsbuddy01@gmail.com
                            </a>
                        </p>
                        
                        <div style={{borderTop: '2px solid #d8b4fe', paddingTop: '16px', marginTop: '16px'}}>
                            <p style={{color: '#6b7280', fontSize: '14px', marginBottom: '12px', lineHeight: '1.6'}}>
                                <strong style={{color: '#7c3aed'}}>âš ï¸ Quick Disclaimer:</strong> This is a free practice tool created by a parent, NOT a certified teacher. 
                                For educational practice only - always follow your school's curriculum. No data collected, no guarantees provided.
                            </p>
                            
                            <p style={{color: '#9ca3af', fontSize: '12px', marginBottom: '16px'}}>
                                By using this tool, you agree to our terms. 
                                <a href="https://github.com/ninjaturtle-007/MyMathsBuddy/blob/main/TERMS_OF_USE.txt" 
                                   target="_blank" 
                                   style={{color: '#7c3aed', textDecoration: 'underline', marginLeft: '4px'}}>
                                    View Full Terms & Conditions
                                </a>
                            </p>
                            
                            <p style={{color: '#6b7280', fontSize: '13px', marginTop: '16px'}}>
                                Made with â¤ï¸ by a mom, for moms and students everywhere
                            </p>
                            <p style={{color: '#7c3aed', fontSize: '14px', marginTop: '12px', fontWeight: '500'}}>
                                Created by <strong>@ninjaturtle_007</strong>
                            </p>
                            <p style={{color: '#9ca3af', fontSize: '12px', marginTop: '8px'}}>
                                Â© 2024 MathBuddy - Free CBSE Math Practice | Licensed under CC BY-NC-SA 4.0
                            </p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
